{"version":3,"sources":["webpack:///webpack/bootstrap ce11cc0466b82517ce1b","webpack:///external \"express\"","webpack:///./server/db/crud.js","webpack:///./server/config.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///external \"wagner-core\"","webpack:///./server/db/connection.js","webpack:///./server/utils/sitemaps/create-sitemap.js","webpack:///./server/utils/sitemaps/utils.js","webpack:///external \"sitemap\"","webpack:///./nuxt.config.js","webpack:///./server/api/index.js","webpack:///./server/utils/sitemaps/schedule.js","webpack:///external \"body-parser\"","webpack:///external \"compression\"","webpack:///external \"helmet\"","webpack:///external \"morgan\"","webpack:///external \"nuxt\"","webpack:///external \"rotating-file-stream\"","webpack:///./server/api/categories.js","webpack:///./server/api/home.js","webpack:///./server/api/promotions.js","webpack:///./server/api/stores.js","webpack:///./server/api/upload.js","webpack:///./server/api/utils.js","webpack:///external \"jimp\"","webpack:///external \"mkdirp\"","webpack:///external \"mongodb\"","webpack:///external \"multer\"","webpack:///external \"node-cron\"","webpack:///external \"request\"","webpack:///external \"zlib\"","webpack:///./server/index.js"],"names":["config","require","module","exports","CRUD","params","COLLECTION","collection","DATABASE","db","ITEMS_PER_PAGE","items_per_page","itemsPerPage","prototype","getItems","find","query","projection","sort","_id","skip","limit","toArray","then","docs","catch","err","getItem","setItem","insertOne","document","res","updateOne","update","searchItems","score","$meta","getPagination","that","count","numItems","numPages","Math","ceil","pages","total","aggregation","aggregate","data","wagner","path","user","password","name","host","shard1","shard2","shard3","queryString","mainCollection","collections","main","secundary","categories","routes","categoriesList","stores","storeList","paths","root","resolve","__dirname","server","static","app_status","factory","MongoClient","getConnection","url","connect","conn","console","log","invoke","utils","sm","fs","request","offers","stores_categories_pages","smPages","modified","getDate","compoundSitemap","createSitemap","add","changefreq","priority","lastmodISO","getData","addToSitemap","route","createSitemapFile","sitemap_path","sitemapName","smOffers","offersSitemap","smIndex","content","writeFile","ping","error","response","body","index","zlib","date","Date","substract","getTime","dateStr","toISOString","split","crud","slug","compress","readable","createReadStream","writable","createWriteStream","gzip","createGzip","pipe","on","end","sitemap","hostname","xmlNs","forEach","current","toString","loading","color","height","cache","head","htmlAttrs","lang","title","meta","charset","link","rel","type","href","sizes","__dangerouslyDisableSanitizers","css","src","plugins","ssr","build","vendor","extend","ctx","isClient","rules","push","enforce","test","loader","exclude","home","promotions","upload","router","Router","use","cron","csm","schedule","checkDate","collecttion","doc","lastOfferDate","lastOfferDateTime","hours","dateMinus12hrs","lastOffer","express","crudInst","conf","indexNoDB","get","req","page","Number","iterable","thumbnail","store_id","img_alt","img_title","img","Promise","all","results","json","items","info","pagination","getFormDataPromotions","createPromotion","item","post","rightNow","Object","assign","published","result","insertedId","$set","length","$or","url_site","mkdirp","jimp","rootPathUploads","getPath","file","finalPath","join","getFullYear","getMonth","multerUpload","files","originalName","originalname","extension","filePath","finalRootPath","read","resize","AUTO","quality","write","success","storage","multer","diskStorage","destination","callback","pathFile","mkdirPromise","filename","array","reject","develop","app","process","env","HOST","port","PORT","morganFormat","logDirectory","existsSync","mkdirSync","accessLogStream","rfs","interval","set","bodyParser","morgan","stream","helmet","disable","nuxtConfig","dev","nuxt","compression","render","exit","listen","sitemapSchedule"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 32);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ce11cc0466b82517ce1b","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","'use strict';\nvar config = require('../config').config;\n\nmodule.exports = CRUD;\n\nfunction CRUD(params) {\n  this.COLLECTION = params.collection;\n  this.DATABASE = params.db;\n  this.ITEMS_PER_PAGE = params.items_per_page || config.db.itemsPerPage;\n};\n\nCRUD.prototype.getItems = function (params) {\n  var db = this.DATABASE || params.db;\n  var items_per_page = params.items_per_page || this.ITEMS_PER_PAGE;\n  return db.collection(this.COLLECTION || params.collection)\n    .find(params.query || {}, params.projection || {} )\n    .sort(params.sort || { _id: 1})\n    .skip(params.skip || 0)\n    .limit(items_per_page)\n    .toArray()\n    .then(function(docs) {\n      if (items_per_page > 1) {\n        return docs;\n      } else {\n        return docs[0];\n      }\n    })\n    .catch(function(err) {\n      return err;\n    });\n};\n\nCRUD.prototype.getItem = function (params) {\n  params.items_per_page = 1;\n  return this.getItems(params);\n};\n\nCRUD.prototype.setItem = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(params.collection || this.COLLECTION)\n    .insertOne(params.document)\n    .then(function(res) {\n      return res;\n    })\n    .catch(function(err) {\n      return err;\n    });\n}\n\nCRUD.prototype.updateOne = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(params.collection || this.COLLECTION)\n  .updateOne(params.query, params.update)\n  .then(function(res) {\n    return res;\n  })\n  .catch(function(err) {\n    return err;\n  });\n}\n\nCRUD.prototype.searchItems = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(this.COLLECTION || params.collection)\n    //we project the textScore meta data and then we sort the results by the best matches first\n    .find(params.query, params.projection || { score: { $meta: 'textScore'} })\n    .sort(params.sort || { score: { $meta: 'textScore'} })\n    .skip(params.skip || 0)\n    .limit(params.items_per_page || this.ITEMS_PER_PAGE)\n    .toArray()\n    .then(function(docs) {\n      return docs;\n    })\n    .catch(function(err) {\n      return err;\n    });\n};\n\nCRUD.prototype.getPagination = function (params) {\n  var that = this;\n  var db = that.DATABASE || params.db;\n  return db.collection(this.COLLECTION || params.collection)\n    .find(params.query || {})\n    .count()\n    .then(function(numItems){\n      var items_per_page = params.items_per_page || that.ITEMS_PER_PAGE;\n      var numPages = 0;\n      if (numItems > items_per_page ) {\n        numPages = Math.ceil(numItems/items_per_page);\n      }\n      return {\n        pages: numPages,\n        total: numItems\n      };\n    })\n    .catch(function(err){\n      return err;\n    });\n};\n\nCRUD.prototype.aggregation = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(this.COLLECTION || params.collection)\n    .aggregate(params.aggregation)\n    .toArray()\n    .then(function(data){\n      return data\n    })\n    .catch(function(err){\n      return err\n    });\n};\n\n\n// WEBPACK FOOTER //\n// ./server/db/crud.js","'use strict';\r\n\r\nvar wagner = require('wagner-core');\r\nvar path = require('path');\r\n\r\nvar config = {\r\n  db: {\r\n    user: \"ofertadeo_publisher\",\r\n    password: \"Cdop_2017*\",\r\n    name: 'ofertadeo',\r\n    host: 'localhost:27017',\r\n    shard1: 'pensemosweb-shard-00-00-147ev.mongodb.net:27017',\r\n    shard2: 'pensemosweb-shard-00-01-147ev.mongodb.net:27017',\r\n    shard3: 'pensemosweb-shard-00-02-147ev.mongodb.net:27017',\r\n    queryString: '?ssl=true&replicaSet=pensemosweb-shard-0&authSource=admin',\r\n    mainCollection: 'offers',\r\n    itemsPerPage: 12,\r\n    collections: {\r\n      main: 'offers',\r\n      secundary: 'stores',\r\n      categories: 'categories',\r\n      pages: 'pages'\r\n    }\r\n  },\r\n  routes: {\r\n    categories: '/categorias',\r\n    categoriesList: '/categorias',\r\n    stores: '/promociones',\r\n    main: '/promociones',\r\n    storeList: '/tiendas'\r\n  },\r\n  host: 'https://www.ofertadeo.com',\r\n  paths: {\r\n    root: path.resolve(__dirname, '../'),\r\n    server: __dirname,\r\n    static:  path.resolve(__dirname, '../static')\r\n  },\r\n  app_status: 'deploy'\r\n};\r\n\r\nmodule.exports = function (wagner) {\r\n  if (wagner) {\r\n    wagner.factory('config', function (){\r\n      return config;\r\n    });\r\n  }\r\n  return config;\r\n};\r\n\r\nmodule.exports.config = config;\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"wagner-core\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"wagner-core\"\n// module id = 5\n// module chunks = 0","'use strict';\r\n\r\nvar MongoClient = require('mongodb').MongoClient;\r\n \r\nfunction getConnection(config) {\r\n  //connPromise is pending when trying to connect to mongodb atlas\r\n  // var shards = config.db.shard1 + ',' + config.db.shard2 + ',' + config.db.shard3;\r\n  // var url = 'mongodb://' + config.db.user + ':' + config.db.password + '@' + shards + '/' + config.db.name + config.db.queryString;\r\n  var url = 'mongodb://' + config.db.user + ':' + config.db.password + '@' + config.db.host + '/' + config.db.name;\r\n\r\n  return MongoClient.connect(url).then(function(conn){\r\n      console.log('It is connected to db: ' + config.db.name + ' in ' + config.db.host );\r\n      return conn;\r\n    })\r\n    .catch(function(err) {\r\n      console.log(err);\r\n      return err;\r\n    });\r\n}\r\n\r\nmodule.exports = function(wagner) {\r\n  wagner.invoke(function(config) {\r\n    var conn = getConnection(config);\r\n    wagner.factory('conn', function() {\r\n      return conn;\r\n    });\r\n  });\r\n  \r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/db/connection.js","var utils = require('./utils.js');\r\nvar config = require('../../config')();\r\nvar sm = require('sitemap')\r\nvar fs = require('fs');\r\nvar request = require('request');\r\n\r\nconfig.paths.static = '/home/jaime/xml';\r\nvar offers = '/sitemap-ofertas.xml';\r\nvar stores_categories_pages = '/sitemap-paginas.xml';\r\n\r\nfunction smPages () {\r\n  var modified = utils.getDate();\r\n  var compoundSitemap = utils.createSitemap();\r\n  \r\n  compoundSitemap.add({url: '/', changefreq: 'daily', priority: 1.0, lastmodISO: modified});\r\n\r\n  utils.getData({ collection: config.db.collections.pages })\r\n  .then(function(data) {\r\n    utils.addToSitemap(compoundSitemap, data,  {\r\n      route: '',\r\n      changefreq: 'weekly',\r\n      priority: 0.7\r\n    });\r\n  })\r\n  .then(function () {\r\n    return utils.getData( { collection: config.db.collections.secundary } )  \r\n  })\r\n  .then(function(data) {\r\n    utils.addToSitemap(compoundSitemap, data,  {\r\n      route: config.routes.storeList,\r\n      changefreq: 'daily',\r\n      priority: 0.9\r\n    });\r\n  })\r\n  .then(function() {\r\n    return utils.getData( { collection: config.db.collections.categories } );\r\n  })\r\n  .then(function(data) {\r\n     utils.addToSitemap(compoundSitemap, data,  {\r\n      route: config.routes.categories,\r\n      changefreq: 'daily',\r\n      priority: 0.9\r\n    });\r\n  })\r\n  .then(function(){\r\n    utils.createSitemapFile(compoundSitemap, {\r\n      sitemap_path: config.paths.static + stores_categories_pages,\r\n      sitemapName: stores_categories_pages\r\n    });    \r\n  })\r\n}\r\n\r\n\r\nfunction smOffers () {\r\n  var offersSitemap = utils.createSitemap();\r\n\r\n  utils.getData({collection: config.db.collections.main })\r\n  .then(function (data) {\r\n    utils.addToSitemap(offersSitemap, data, {\r\n      route: config.routes.main,\r\n      changefreq: 'daily',\r\n      priority: 0.5\r\n    });\r\n  })\r\n  .then(function() {\r\n    utils.createSitemapFile(offersSitemap, {\r\n      sitemap_path: config.paths.static + offers,\r\n      sitemapName: offers\r\n    });\r\n  });\r\n}\r\n\r\nfunction smIndex () {\r\n  var content = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\r\n<sitemap>\r\n  <loc>https://www.ofertadeo.com/sitemap-paginas.xml</loc>\r\n  <lastmod>` + utils.getDate() +`</lastmod>\r\n</sitemap>\r\n<sitemap>\r\n  <loc>https://www.ofertadeo.com/sitemap-ofertas.xml</loc>\r\n  <lastmod>` + utils.getDate() +`</lastmod>\r\n</sitemap>\r\n</sitemapindex>`;\r\n\r\n  fs.writeFile(config.paths.static + '/sitemap.xml', content, 'utf8', function(err) {\r\n    if (err) {\r\n      return console.log(err);\r\n    }\r\n    console.log('Index sitemap is created :=)');\r\n  });\r\n}\r\n\r\nfunction ping () {\r\n  if(config.app_status === 'deploy') {\r\n    request('https://www.google.com/webmasters/sitemaps/ping?sitemap=https://www.ofertadeo.com/sitemap.xml', function(error, response, body) {\r\n      if(error) {\r\n        console.log('------------------------------------------');\r\n        console.log(utils.getDate());\r\n        console.log('error: ', error);\r\n        console.log('------------------------------------------');\r\n        return;\r\n      }\r\n      console.log('------------------------------------------');\r\n      console.log(utils.getDate());\r\n      console.log('success ping to GOOGLE sitemap!!:');\r\n      console.log('------------------------------------------');\r\n      console.log(body);\r\n    });\r\n\r\n    request('https://www.bing.com/webmaster/ping.aspx?siteMap=https://www.ofertadeo.com/sitemap.xml', function(error, response, body) {\r\n      if(error) {\r\n        console.log('------------------------------------------');\r\n        console.log(utils.getDate());\r\n        console.log('error: ', error);\r\n        console.log('------------------------------------------');\r\n        return;\r\n      }\r\n      console.log('------------------------------------------');\r\n      console.log(utils.getDate());\r\n      console.log('success ping to BING sitemap!!:');\r\n      console.log('------------------------------------------');\r\n      console.log(body);\r\n    });\r\n  }\r\n}\r\n\r\n\r\nmodule.exports = {\r\n  index: smIndex,\r\n  pages: smPages,\r\n  offers: smOffers,\r\n  ping: ping\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/create-sitemap.js","var wagner = require('wagner-core');\r\nvar sm = require('sitemap')\r\nvar config = require('../../config.js')(wagner);\r\nrequire('../../db/connection.js')(wagner);\r\nvar CRUD = require('../../db/crud.js');\r\nvar fs = require('fs');\r\nvar zlib = require('zlib');\r\n\r\nfunction getDate () {\r\n  var date = new Date();\r\n  var substract = date.getTime() - (300*60*1000);\r\n  var dateStr = new Date(substract).toISOString().split('.')[0];\r\n  return dateStr + '-05:00';\r\n}\r\n\r\nfunction getData (params) {\r\n  return wagner.invoke(function(conn) {\r\n      return conn;\r\n    }).then(function(db) {\r\n      return new CRUD({ db: db });\r\n    }).then(function(crud){\r\n      return crud.getItems({\r\n          collection: params.collection || 'offers',\r\n          query: params.query || {},\r\n          projection: params.projection || { slug: 1, modified: 1 },\r\n          items_per_page: params.items_per_page || 10000,\r\n          sort: { _id: -1 }\r\n        })\r\n    });\r\n}\r\n\r\nfunction compress(path) {\r\n  var readable = fs.createReadStream(path);\r\n  var writable = fs.createWriteStream(path + '.gz');\r\n  var gzip = zlib.createGzip();\r\n  readable.pipe(gzip).pipe(writable);\r\n  gzip.on('end', function () {\r\n    writable.end();\r\n    console.log(path + ' sitemap file is compressed!!');\r\n  });\r\n}\r\n\r\nfunction createSitemap () {\r\n  var sitemap = sm.createSitemap({\r\n    hostname: config.host,\r\n    xmlNs: `xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\r\n      xmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\"\r\n      xmlns:video=\"http://www.google.com/schemas/sitemap-video/1.1\"\r\n      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n      xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\r\n      xsi:schemaLocation=\"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd\"`\r\n  });\r\n\r\n  return sitemap\r\n}\r\n\r\nfunction addToSitemap(sitemap, data, params) {\r\n  data.forEach(function(current) {\r\n    sitemap.add({\r\n      url: params.route + '/' + current.slug,\r\n      changefreq: params.changefreq || 'daily',\r\n      priority: params.priority || 0.5,\r\n      lastmodISO: current.modified || getDate()\r\n    });\r\n  });\r\n\r\n  return sitemap\r\n}\r\n\r\nfunction createSitemapFile (sitemap, params) {\r\n  fs.writeFile(params.sitemap_path, sitemap.toString(), function(err) {\r\n    if (err) {\r\n      return console.log(err);\r\n    }\r\n    console.log(params.sitemapName + ' sitemap has been created!!');\r\n    compress(params.sitemap_path);\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  createSitemap: createSitemap,\r\n  createSitemapFile: createSitemapFile,\r\n  compress: compress,\r\n  addToSitemap: addToSitemap,\r\n  getData: getData,\r\n  getDate: getDate\r\n} \n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/utils.js","module.exports = require(\"sitemap\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sitemap\"\n// module id = 9\n// module chunks = 0","module.exports = {\n  loading: {\n    color: '#ff80ab',\n    height: '11px'\n  },\n  cache: true,\n  /*\n  ** Headers of the page\n  */\n  head: {\n    htmlAttrs: {\n      lang: 'es-MX'\n    },\n    title: 'Ofertas, promociones y descuentos en Mxico | Ofertadeo',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { name: 'theme-color', content:'#1976d2' },\n      { name: 'msapplication-TileColor', content: '#2d89ef' },\n      { name: 'msapplication-TileImage', content: '/favicons/mstile-144x144.png' },\n      { name: 'msapplication-config', content: '/favicons/browserconfig.xml' },\n      { name: 'p:domain_verify', content: 'd22a77a044a4490ebd5019e778f4a37b' },\n      { name: 'google-site-verification', content: '-jN3QPeaXQTbgPBlyAXlXXh7qRSesWIpa3GC3ijTjJM' },\n      { name: 'msvalidate.01', content: '162D9E28E432D290B43E41702E108642' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicons/favicon.ico' },\n      { rel: 'apple-touch-icon', sizes: '180x180', href: '/favicons/apple-touch-icon.png' },\n      { rel: 'icon', type: 'image/png', sizes: '32x32', href: '/favicons/favicon-32x32.png' },\n      { rel: 'icon', type: 'image/png', sizes: '16x16', href: '/favicons/favicon-16x16.png' },\n      { rel: 'manifest', href: '/favicons/manifest.json'},\n      { rel: 'mask-icon', href: '/favicons/safari-pinned-tab.svg', color: '#1976d2' },\n      { rel: 'shortcut icon', href: '/favicons/favicon.ico' },\n      { rel: 'dns-prefetch', href:'//www.google-analytics.com' }\n    ],\n    __dangerouslyDisableSanitizers: ['script']\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n     { src: '~assets/stylus/main.styl', lang: 'stylus' },\n     { src: '~assets/css/main.scss', lang: 'scss' } // scss instead of sass\n  ],\n  plugins: [\n    { src: '~plugins/ga.js', ssr: false }\n  ],\n  /*\n  ** Add axios globally\n  */\n  build: {\n    vendor: ['axios','~plugins/striptags.js'],\n    /*\n    ** Run ESLINT on save\n    */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import { Router } from 'express'\nvar wagner = require('wagner-core');\nvar home = require('./home');\nvar categories = require('./categories');\nvar stores = require('./stores');\nvar promotions = require('./promotions');\nvar upload = require('./upload');\n\nrequire('../config.js')(wagner);\nrequire('../db/connection.js')(wagner);\n\nvar router = Router()\n// Add USERS Routes\nrouter.use(home(wagner))\nrouter.use(categories(wagner))\nrouter.use(stores(wagner))\nrouter.use(promotions(wagner))\nrouter.use(upload(wagner))\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/index.js","var cron = require('node-cron');\r\nvar csm = require('./create-sitemap.js');\r\nvar utils = require('./utils.js');\r\nvar config = require('../../config.js')();\r\n\r\n\r\nvar schedule = {\r\n\tping: ping\r\n};\r\n\r\nfunction checkDate () {\r\n\treturn utils.getData({\r\n\t\tcollecttion: config.db.collections.main,\r\n\t\tquery: {},\r\n\t\titems_per_page: 1,\r\n\t\tsort: { _id: -1 },\r\n\t\tprojection: { modified: 1 }\r\n\t}).then(function(doc){\r\n\t\tlet lastOfferDate = new Date(doc.modified);\r\n\t\tlet lastOfferDateTime = new Date(doc.modified).getTime();\r\n\t\tlet hours = 12*60*60*1000;\r\n\t\tlet dateMinus12hrs = new Date().getTime() - hours;\r\n\t\tif(lastOfferDateTime >= dateMinus12hrs) {\r\n\t\t\treturn {\r\n\t\t\t\tlastOffer: new Date(doc.modified),\r\n\t\t\t\tping: true\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn false;\r\n\t});\r\n}\r\n\r\n\r\n\r\nfunction ping () {\r\n\t//cron.schedule('* 12 * * *', function (){//run every 5 minutes after midnigh everyday\r\n\tcron.schedule('*/1 * * * *', function (){//run every 5 minutes after midnigh everyday\r\n\t  checkDate().then(function(res) {\r\n\t  \tif(res && res.ping) {\r\n\t  \t\tconsole.log(res)\r\n\t  \t\tcsm.ping()\r\n\t  \t}\r\n\t  }).catch(function(err) {\r\n\t  \tconsole.log(err);\r\n\t  });\r\n\t});\r\n\r\n\tcron.schedule('50 23 * * *', function () {//run every 6 hours\r\n\t\t\tcheckDate().then(function(res) {\r\n\t\t  \tif(res && res.ping) {\r\n\t\t  \t\tconsole.log(res)\r\n\t\t  \t\tcsm.ping()\r\n\t\t  \t}\r\n\t\t  }).catch(function(err) {\r\n\t\t  \tconsole.log(err);\r\n\t\t  });\r\n\t});\t\r\n}\r\n\r\nmodule.exports = schedule\n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/schedule.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"rotating-file-stream\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rotating-file-stream\"\n// module id = 18\n// module chunks = 0","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\n\nvar crudInst;\nvar conf;\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  })\n  .then(function(){\n    if(crudInst) {\n      _id();\n      index()\n    } else {\n      indexNoDB();\n    }\n    \n  });\n\n  return router;\n};\n\nfunction _id() {\n  router.get('/categories/:_id', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.main,\n        query: { categories: req.params._id },\n        items_per_page: conf.db.itemsPerPage,\n        skip: conf.db.itemsPerPage*page,\n        sort: { _id: -1},\n        projection: {name: 1, thumbnail: 1, store_id: 1, stores: 1, slug: 1, img_alt: 1, img_title: 1}\n      }),\n      crudInst.getItem({\n        collection:  conf.db.collections.categories,\n        query: {_id: req.params._id},\n        projection: {name:1, thumbnail: 1, slug: 1, content: 1, img: 1, img_alt: 1, img_title: 1}\n      }),\n      crudInst.getPagination({\n        query: { store_id: req.params._id },\n        collection: conf.db.collections.main\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          info: results[1],\n          pagination: results[2]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\nfunction index() {\n  router.get('/categories', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.categories,\n        items_per_page: conf.db.itemsPerPage, \n        skip: conf.db.itemsPerPage*page,\n        sort: { name: 1},\n        projection: { name: 1, slug: 1, thumbnail: 1, img_alt:1, img_title: 1 }\n      }),\n      crudInst.getPagination({\n        collection: conf.db.collections.categories\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          pagination: results[1]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/categories.js","'use strict';\r\n\r\nvar express = require('express');\r\nvar router = express.Router();\r\nvar CRUD = require('../db/crud.js');\r\nvar crudInst;\r\nvar conf;\r\n\r\nmodule.exports = function(wagner, params) {\r\n  wagner.invoke(function(conn, config) {\r\n    conf = config;\r\n    return conn;\r\n  })\r\n  .then(function(db){\r\n    crudInst = new CRUD({\r\n      db:db\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    //some configuration to notify no database connection working\r\n    console.log(err);\r\n  })\r\n  .then(function(){\r\n    if(crudInst) {\r\n      index();  \r\n    } else {\r\n      indexNoDB();\r\n    }\r\n    \r\n  });\r\n\r\n  return router;\r\n};\r\n\r\nfunction index() {\r\n  router.get('/home', function(req, res) {\r\n    var page = req.query.page ? Number(req.query.page) : 0;\r\n    var iterable = [\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.main,\r\n        items_per_page: conf.db.itemsPerPage, \r\n        skip: conf.db.itemsPerPage*page,\r\n        sort: { _id: -1},\r\n        projection: { name: 1, thumbnail: 1, store_id: 1, stores: 1, slug: 1, img_alt:1, img_title: 1, title: 1 }\r\n      }),\r\n      crudInst.getPagination({\r\n        collection: conf.db.collections.main,\r\n      })\r\n    ];\r\n\r\n    Promise.all(iterable)\r\n    .then(function(results) {\r\n      res.json({\r\n          items: results[0],\r\n          pagination: results[1]\r\n        });\r\n    })\r\n    .catch(function(error) {\r\n      res.json(error);\r\n    });\r\n  });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/home.js","'use strict';\r\n\r\nvar express = require('express');\r\nvar router = express.Router();\r\nvar utils = require('./utils');\r\nvar CRUD = require('../db/crud.js');\r\nvar csm = require('../utils/sitemaps/create-sitemap.js');\r\n\r\nvar crudInst;\r\nvar conf;\r\nmodule.exports = function(wagner, params) {\r\n  wagner.invoke(function(conn, config) {\r\n    conf = config;\r\n    return conn;\r\n  })\r\n  .then(function(db){\r\n    crudInst = new CRUD({\r\n      db:db\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    //some configuration to notify no database connection working\r\n    console.log(err);\r\n  })\r\n  .then(function(){\r\n    if(crudInst) {\r\n      slug();\r\n      getFormDataPromotions();\r\n      createPromotion();\r\n    }    \r\n  });\r\n\r\n  return router;\r\n};\r\n\r\nfunction slug() {\r\n  router.get('/promotions/:slug', function(req, res) {\r\n    var iterable = [\r\n      crudInst.getItem({\r\n        collection: conf.db.mainCollection,\r\n        query: { slug: req.params.slug },\r\n        items_per_page: 1,\r\n        sort: { _id: -1}\r\n      })\r\n    ];\r\n\r\n    return Promise.all(iterable)\r\n          .then(function(results) {\r\n            res.json({\r\n                item: results[0]\r\n              });\r\n          })\r\n          .catch(function(error) {\r\n            res.json(error);\r\n          });\r\n        });\r\n}\r\n\r\n\r\nfunction getFormDataPromotions() {\r\n  router.get('/formdata/promotions', function(req, res) {\r\n    var iterable = [\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.secundary,\r\n        items_per_page: 100,\r\n        projection: { name: 1 },\r\n        sort: { name: 1}\r\n      }),\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.categories,\r\n        items_per_page: 100,\r\n        projection: { name: 1 },\r\n        sort: { name: 1}\r\n      })\r\n    ];\r\n\r\n    Promise.all(iterable)\r\n      .then(function(results) {\r\n        res.json({\r\n            stores: results[0],\r\n            categories: results[1]\r\n          });\r\n      })\r\n      .catch(function(error) {\r\n        res.json(error);\r\n      });\r\n\r\n  });\r\n}\r\n\r\nfunction createPromotion () {\r\n  router.post('/promotions/new', function(req, res) {\r\n    var rightNow = utils.getDate();\r\n    var data = Object.assign({ modified: rightNow, published: rightNow }, req.body);\r\n    crudInst.setItem({\r\n      collection: conf.db.mainCollection,\r\n      document: data\r\n    })\r\n    .then(function(result){\r\n      res.json(result);\r\n      if(result.insertedId) {\r\n        // @TODO, when we use more than one category and more than one store, the updateOne \r\n        // operation should be execute for each element in the arrary categories and stores\r\n        return Promise.all([\r\n            crudInst.updateOne({\r\n              collection: conf.db.collections.main,\r\n              query: { _id: result.insertedId },\r\n              update: { $set: { modified: utils.getDate() } }\r\n            }),\r\n            crudInst.updateOne({\r\n              collection: conf.db.collections.secundary,\r\n              query: { _id: data.stores[0] },\r\n              update: { $set: { modified: utils.getDate() } }\r\n            }),\r\n            crudInst.updateOne({\r\n              collection: conf.db.collections.categories,\r\n              query: { _id: data.categories[0] },\r\n              update: { $set: { modified: utils.getDate() } }\r\n            })\r\n          ])\r\n      }\r\n    })\r\n    .then(function(results) {\r\n      if(results && results.length > 0) {\r\n        csm.pages()\r\n        csm.offers()\r\n        csm.index()\r\n      }\r\n    })\r\n    .catch(function(err){\r\n      res.json(err);\r\n    });\r\n  });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/promotions.js","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\nvar crudInst;\nvar conf;\n\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  })\n  .then(function(){\n    if(crudInst) {\n      _id();\n      index();\n    }\n  });\n\n  return router;\n};\n\nfunction _id() {\n  router.get('/stores/:_id', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.main,\n        query: { $or: [ { store_id: req.params._id }, { stores: req.params._id } ] },\n        items_per_page: conf.db.itemsPerPage,\n        skip: conf.db.itemsPerPage*page,\n        sort: { _id: -1},\n        projection: {name: 1, thumbnail: 1, store_id: 1, stores: 1, slug: 1, img: 1, img_alt:1, img_title:1, categories: 1 }\n      }),\n      crudInst.getItem({\n        collection:  conf.db.collections.secundary,\n        query: {_id: req.params._id},\n        projection: {name:1, thumbnail: 1, slug: 1, url_site: 1, content: 1, img: 1, img_alt:1, img_title: 1}\n      }),\n      crudInst.getPagination({\n        query: { store_id: req.params._id },\n        collection: conf.db.collections.main\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          info: results[1],\n          pagination: results[2]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\nfunction index() {\n  router.get('/stores', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.secundary,\n        items_per_page: conf.db.itemsPerPage, \n        skip: conf.db.itemsPerPage*page,\n        sort: { name: 1},\n        projection: { name: 1, slug: 1, thumbnail: 1, img_alt:1, img_title:1 }\n      }),\n      crudInst.getPagination({\n        collection: conf.db.collections.secundary\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          pagination: results[1]\n        });\n    })\n    .catch(function(error) {\n      console.log(error);\n      res.json(error);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/stores.js","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\nvar mkdirp = require('mkdirp');\nvar path = require('path');\nimport multer from 'multer'\nvar jimp = require('jimp')\n\nvar crudInst;\nvar conf;\nvar rootPathUploads = '/home/jaime'\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  })\n  .then(function(){\n    if(crudInst) {\n      upload();\n    }    \n  });\n\n  return router;\n};\n\nfunction getPath(file) {\n  var date = new Date();\n  var finalPath = path.join(`${rootPathUploads}/uploads/${date.getFullYear()}/${(date.getMonth()+1)}/${date.getDate()}`);\n  if(file) {\n    finalPath = `${finalPath}/{file.originalname}`;\n  }\n  return finalPath;\n}\n\nfunction upload() {\n  router.post('/upload', function(req, res) {\n    return multerUpload(req, res, function (err) {\n      if (err) {\n        res.json(error);\n      }\n\n      var path = getPath();\n      var file = req.files[0];\n      var originalName = file.originalname\n      var name = originalName.split('.')[0];\n      var extension = originalName.split('.')[1];\n      var filePath = `${path}/${originalName}`;\n      var finalRootPath = path.split(rootPathUploads)[1];\n\n      jimp.read(filePath)\n      .then(function (img) {\n          img.resize(jimp.AUTO, 300)// resize\n               .quality(60)// set JPEG quality\n               .write(`${path}/${name}_thumb.${extension}`); // save\n      }).then(function(result) {\n        res.json({ success: true, img: conf.host + filePath.split(rootPathUploads)[1], thumbnail: `${conf.host}${finalRootPath}/${name}_thumb.${extension}`});\n      }).catch(function (err) {\n        res.json(err);\n      });      \n    });\n  });\n}\n\nvar storage = multer.diskStorage({\n    destination: function (req, file, callback) {\n        var pathFile = getPath();\n        mkdirPromise(pathFile)\n        .then(function(success){\n          callback(null, pathFile);\n        })\n        .catch(function(err){\n          console.log(err);\n        })\n        \n    },\n    filename: function (req, file, callback) {\n        callback(null, file.originalname);\n    }\n});\n\nvar multerUpload = multer({ storage: storage }).array(\"offerFile\", 3); //Field name and max count\n\nfunction mkdirPromise (pathFile) {\n  return new Promise(function(resolve, reject){\n    mkdirp(pathFile, function (err) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(`Directorio creado: ${pathFile}`);\n      }\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/upload.js","function getDate () {\n  var date = new Date();\n  var substract = date.getTime() - (300*60*1000);\n  var dateStr = new Date(substract).toISOString().split('.')[0];\n  return dateStr + '-05:00';\n}\n\n\nmodule.exports  = {\n\tgetDate: getDate\n};\n\n\n// WEBPACK FOOTER //\n// ./server/api/utils.js","module.exports = require(\"jimp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jimp\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"node-cron\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-cron\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"request\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"zlib\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"zlib\"\n// module id = 31\n// module chunks = 0","import Nuxt from 'nuxt'\nimport express from 'express'\nimport compression from 'compression'\nimport helmet from 'helmet'\nimport api from './api'\nimport bodyParser from 'body-parser' \nimport morgan from 'morgan'\nimport rfs from 'rotating-file-stream'\nimport path from 'path'\nimport fs from 'fs'\nimport sitemapSchedule from './utils/sitemaps/schedule'\n\nconst develop = !(process.env.NODE_ENV === 'production')\nconst app = express()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\nlet morganFormat = 'combined'\n\nlet logDirectory = path.join(__dirname, '../log')\n// ensure log directory exists\nfs.existsSync(logDirectory) || fs.mkdirSync(logDirectory)\n// create a rotating write stream\nvar accessLogStream = rfs('access.log', {\n  interval: '1d', // rotate daily\n  path: logDirectory\n})\n\napp.set('port', port)\n\n//For some reason in develop, express precondition provoke an error when the user load more\n//offers using ajax\nif(!develop) {\n\t//const preconditions = require('express-preconditions');\n\t//app.use(preconditions())\n  //morganFormat = 'dev'\n}\napp.use(bodyParser.json())\n// Import API Routes\napp.use('/api', api)\napp.use(morgan(morganFormat, { stream: accessLogStream }))\n//Security\napp.use(helmet())\napp.disable('x-powered-by');\n\n// Import and Set Nuxt.js options\nlet nuxtConfig = require('../nuxt.config.js')\nnuxtConfig.dev = develop\n\n// Init Nuxt.js\nconst nuxt = new Nuxt(nuxtConfig)\n//before nuxt render to compress data\napp.set('view cache', true);//Cache template compilation\napp.use(compression());//Compress all the data that the server response\n\n//At the end because it won't call next()\napp.use(nuxt.render)\n\n// Build only in dev mode\nif (nuxtConfig.dev) {\n  nuxt.build()\n  .catch((error) => {\n    console.error(error) // eslint-disable-line no-console\n    process.exit(1)\n  })\n}\n\n// Listen the server\napp.listen(port)\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n//Schedule ping to web search engines\nsitemapSchedule.ping()\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}