{"version":3,"sources":["webpack:///webpack/bootstrap ea9ba76b52b0996eacbd","webpack:///external \"express\"","webpack:///./server/db/crud.js","webpack:///./server/config.js","webpack:///external \"wagner-core\"","webpack:///external \"body-parser\"","webpack:///./server/db/connection.js","webpack:///external \"fs\"","webpack:///external \"sitemap\"","webpack:///./nuxt.config.js","webpack:///./server/api/index.js","webpack:///./server/utils/sitemaps/create-sitemap.js","webpack:///external \"compression\"","webpack:///external \"express-preconditions\"","webpack:///external \"helmet\"","webpack:///external \"node-cron\"","webpack:///external \"nuxt\"","webpack:///./server/api/categories.js","webpack:///./server/api/home.js","webpack:///./server/api/promotions.js","webpack:///./server/api/stores.js","webpack:///./server/utils/sitemaps/utils.js","webpack:///external \"mongodb\"","webpack:///external \"path\"","webpack:///external \"zlib\"","webpack:///./server/index.js"],"names":["DATABASE","COLLECTION","ITEMS_PER_PAGE","module","exports","params","collection","db","items_per_page","getPagination","getItems","getItem","searchItems","aggregation","find","query","projection","sort","_id","skip","limit","toArray","then","docs","catch","err","score","$meta","count","numItems","numPages","Math","ceil","pages","total","aggregate","data","wagner","require","path","config","user","password","name","host","shard1","shard2","shard3","queryString","mainCollection","routes","categories","categoriesList","stores","main","storeList","paths","root","resolve","__dirname","server","static","factory","MongoClient","getConnection","url","connect","conn","console","log","invoke","loading","color","height","head","title","meta","charset","content","link","rel","type","href","sizes","htmlAttrs","lang","css","src","plugins","ssr","build","vendor","extend","ctx","isClient","rules","push","enforce","test","loader","exclude","bodyParser","home","promotions","router","Router","use","utils","sm","fs","offers","stores_categories_pages","smPages","modified","getDate","compoundSitemap","createSitemap","add","changefreq","priority","lastmodISO","getData","addToSitemap","route","createSitemapFile","sitemap_path","sitemapName","smOffers","offersSitemap","smIndex","date","Date","toISOString","writeFile","index","express","crudFn","crudInst","conf","indexNoDB","get","req","res","page","Number","iterable","thumbnail","store_id","slug","img_alt","img_title","img","Promise","all","results","json","items","info","pagination","error","item","url_site","crud","zlib","compress","readable","createReadStream","writable","createWriteStream","gzip","createGzip","pipe","on","end","sitemap","hostname","xmlNs","forEach","current","toString","cron","csm","preconditions","helmet","app","process","env","HOST","port","PORT","set","disable","nuxtConfig","dev","nuxt","compression","render","exit","listen","schedule"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 24);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ea9ba76b52b0996eacbd","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","'use strict';\n\nvar DATABASE;\nvar COLLECTION;\nvar ITEMS_PER_PAGE;\n\nmodule.exports = function(params) {\n  COLLECTION = params.collection;\n  DATABASE = params.db;\n  ITEMS_PER_PAGE = params.items_per_page || 6;\n\n  return {\n    getPagination: getPagination,\n    getItems: getItems,\n    getItem: getItem,\n    searchItems: searchItems,\n    aggregation: aggregation\n  };\n};\n\nfunction getItems(params) {\n  var db = DATABASE || params.db;\n  var items_per_page = params.items_per_page || ITEMS_PER_PAGE;\n  return db.collection(COLLECTION || params.collection)\n    .find(params.query || {}, params.projection || {} )\n    .sort(params.sort || { _id: 1})\n    .skip(params.skip || 0)\n    .limit(items_per_page)\n    .toArray()\n    .then(function(docs) {\n      if (items_per_page > 1) {\n        return docs;\n      } else {\n        return docs[0];\n      }\n    })\n    .catch(function(err) {\n      return err;\n    });\n}\n\nfunction getItem(params) {\n  params.items_per_page = 1;\n  return getItems(params);\n}\n\nfunction searchItems(params) {\n  var db = DATABASE || params.db;\n  return db.collection(COLLECTION || params.collection)\n    //we project the textScore meta data and then we sort the results by the best matches first\n    .find(params.query, params.projection || { score: { $meta: 'textScore'} })\n    .sort(params.sort || { score: { $meta: 'textScore'} })\n    .skip(params.skip || 0)\n    .limit(params.items_per_page || ITEMS_PER_PAGE)\n    .toArray()\n    .then(function(docs) {\n      return docs;\n    })\n    .catch(function(err) {\n      return err;\n    });\n}\n\nfunction getPagination(params) {\n  var db = DATABASE || params.db;\n  return db.collection(COLLECTION || params.collection)\n    .find(params.query || {})\n    .count()\n    .then(function(numItems){\n      var items_per_page = params.items_per_page || ITEMS_PER_PAGE;\n      var numPages = 0;\n      if (numItems > items_per_page ) {\n        numPages = Math.ceil(numItems/items_per_page);\n      }\n      return {\n        pages: numPages,\n        total: numItems\n      };\n    })\n    .catch(function(err){\n      return err;\n    });\n}\n\nfunction aggregation(params) {\n  var db = DATABASE || params.db;\n  return db.collection(COLLECTION || params.collection)\n    .aggregate(params.aggregation)\n    .toArray()\n    .then(function(data){\n      return data\n    })\n    .catch(function(err){\n      return err\n    });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/db/crud.js","'use strict';\r\n\r\nvar wagner = require('wagner-core');\r\nvar path = require('path');\r\n\r\nvar config = {\r\n  db: {\r\n    user: \"ofertadeo\",\r\n    password: \"Cdo_2017*\",\r\n    name: 'ofertadeo',\r\n    host: 'ds161471.mlab.com:61471',\r\n    shard1: 'pensemosweb-shard-00-00-147ev.mongodb.net:27017',\r\n    shard2: 'pensemosweb-shard-00-01-147ev.mongodb.net:27017',\r\n    shard3: 'pensemosweb-shard-00-02-147ev.mongodb.net:27017',\r\n    queryString: '?ssl=true&replicaSet=pensemosweb-shard-0&authSource=admin',\r\n    mainCollection: 'offers'\r\n  },\r\n  routes: {\r\n    categories: '/categorias',\r\n    categoriesList: '/categorias',\r\n    stores: '/promociones',\r\n    main: '/promociones',\r\n    storeList: '/tiendas'\r\n  },\r\n  host: 'https://www.ofertadeo.com',\r\n  paths: {\r\n    root: path.resolve(__dirname, '../'),\r\n    server: __dirname,\r\n    static:  path.resolve(__dirname, '../static')\r\n  }\r\n};\r\n\r\nmodule.exports = function (wagner) {\r\n  if (wagner) {\r\n    wagner.factory('config', function (){\r\n      return config;\r\n    });\r\n  }\r\n  return config;\r\n};\r\n\r\nmodule.exports.config = config;\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = require(\"wagner-core\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"wagner-core\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 4\n// module chunks = 0","'use strict';\r\n\r\nvar MongoClient = require('mongodb').MongoClient;\r\n \r\nfunction getConnection(config) {\r\n  //connPromise is pending when trying to connect to mongodb atlas\r\n  // var shards = config.db.shard1 + ',' + config.db.shard2 + ',' + config.db.shard3;\r\n  // var url = 'mongodb://' + config.db.user + ':' + config.db.password + '@' + shards + '/' + config.db.name + config.db.queryString;\r\n  var url = 'mongodb://' + config.db.user + ':' + config.db.password + '@' + config.db.host + '/' + config.db.name;\r\n\r\n  return MongoClient.connect(url).then(function(conn){\r\n      console.log('It is connected to db: ' + config.db.name + ' in ' + config.db.host );\r\n      return conn;\r\n    })\r\n    .catch(function(err) {\r\n      console.log(err);\r\n      return err;\r\n    });\r\n}\r\n\r\nmodule.exports = function(wagner) {\r\n  wagner.invoke(function(config) {\r\n    var conn = getConnection(config);\r\n    wagner.factory('conn', function() {\r\n      return conn;\r\n    });\r\n  });\r\n  \r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/db/connection.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"sitemap\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sitemap\"\n// module id = 7\n// module chunks = 0","module.exports = {\n  loading: {\n    color: '#ff80ab',\n    height: '11px'\n  },\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'Ofertas, promociones y descuentos en México | Ofertadeo',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { name: 'theme-color', content:'#1976d2' },\n      { name: 'msapplication-TileColor', content: '#2d89ef' },\n      { name: 'msapplication-TileImage', content: '/favicons/mstile-144x144.png' },\n      { name: 'msapplication-config', content: '/favicons/browserconfig.xml' },\n      { name: 'p:domain_verify', content: 'd22a77a044a4490ebd5019e778f4a37b' },\n      { name: 'google-site-verification', content: '-jN3QPeaXQTbgPBlyAXlXXh7qRSesWIpa3GC3ijTjJM' },\n      { name: 'msvalidate.01', content: '162D9E28E432D290B43E41702E108642' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicons/favicon.ico' },\n      { rel: 'apple-touch-icon', sizes: '180x180', href: '/favicons/apple-touch-icon.png' },\n      { rel: 'icon', type: 'image/png', sizes: '32x32', href: '/favicons/favicon-32x32.png' },\n      { rel: 'icon', type: 'image/png', sizes: '16x16', href: '/favicons/favicon-16x16.png' },\n      { rel: 'manifest', href: '/favicons/manifest.json'},\n      { rel: 'mask-icon', href: '/favicons/safari-pinned-tab.svg', color: '#1976d2' },\n      { rel: 'shortcut icon', href: '/favicons/favicon.ico' },\n      { rel: 'dns-prefetch', href:'//www.google-analytics.com' }\n    ],\n    htmlAttrs: {\n      lang: 'es-MX'\n    }\n  },\n  /*\n  ** Global CSS\n  */\n  css: [\n     { src: '~assets/stylus/main.styl', lang: 'stylus' },\n     { src: '~assets/css/main.scss', lang: 'scss' } // scss instead of sass\n  ],\n  plugins: [\n    { src: '~plugins/ga.js', ssr: false }\n  ],\n  /*\n  ** Add axios globally\n  */\n  build: {\n    vendor: ['axios','~plugins/striptags.js'],\n    /*\n    ** Run ESLINT on save\n    */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import { Router } from 'express'\nvar bodyParser = require('body-parser');\nvar wagner = require('wagner-core');\nvar home = require('./home');\nvar categories = require('./categories');\nvar stores = require('./stores');\nvar promotions = require('./promotions');\n\nrequire('../config.js')(wagner);\nrequire('../db/connection.js')(wagner);\n\nvar router = Router()\n// Add USERS Routes\nrouter.use(home(wagner))\nrouter.use(categories(wagner))\nrouter.use(stores(wagner))\nrouter.use(promotions(wagner))\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/index.js","var utils = require('./utils.js');\r\nvar config = require('../../config')();\r\nvar sm = require('sitemap')\r\nvar fs = require('fs');\r\n\r\nvar offers = '/sitemaps/sitemap-ofertas.xml';\r\nvar stores_categories_pages = '/sitemaps/sitemap-paginas.xml';\r\n\r\n\r\nfunction smPages () {\r\n  var modified = utils.getDate();\r\n  var compoundSitemap = utils.createSitemap();\r\n  compoundSitemap.add({url: '/', changefreq: 'daily', priority: 1.0, lastmodISO: modified});\r\n  compoundSitemap.add({url: config.routes.storeList, changefreq: 'weekly', priority: 0.7, lastmodISO: modified});\r\n  compoundSitemap.add({url: config.routes.categoriesList, changefreq: 'weekly', priority: 0.7, lastmodISO: modified});\r\n\r\n  utils.getData( { collection: 'stores'} )\r\n  .then(function(data) {\r\n    utils.addToSitemap(compoundSitemap, data,  {\r\n      route: config.routes.storeList,\r\n      changefreq: 'daily',\r\n      priority: 0.9\r\n    });\r\n  })\r\n  .then(function() {\r\n    utils.getData( { collection: 'categories'} )\r\n    .then(function(data) {\r\n      utils.addToSitemap(compoundSitemap, data,  {\r\n        route: config.routes.categories,\r\n        changefreq: 'daily',\r\n        priority: 0.9\r\n      });\r\n\r\n      utils.createSitemapFile(compoundSitemap, {\r\n        sitemap_path: config.paths.static + stores_categories_pages,\r\n        sitemapName: stores_categories_pages\r\n      });\r\n\r\n    });\r\n  });\r\n}\r\n\r\n\r\nfunction smOffers () {\r\n  var offersSitemap = utils.createSitemap();\r\n\r\n  utils.getData({collection: config.db.mainCollection })\r\n  .then(function (data) {\r\n    utils.addToSitemap(offersSitemap, data, {\r\n      route: config.routes.main,\r\n      changefreq: 'daily',\r\n      priority: 0.5\r\n    });\r\n  })\r\n  .then(function() {\r\n    utils.createSitemapFile(offersSitemap, {\r\n      sitemap_path: config.paths.static + offers,\r\n      sitemapName: offers\r\n    });\r\n  });\r\n}\r\n\r\nfunction smIndex () {\r\n\r\n  var date = new Date().toISOString();\r\n\r\n  var content = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\r\n<sitemap>\r\n  <loc>https://www.ofertadeo.com/sitemaps/sitemap-paginas.xml.gz</loc>\r\n  <lastmod>` + date +` </lastmod>\r\n</sitemap>\r\n<sitemap>\r\n  <loc>https://www.ofertadeo.com/sitemaps/sitemap-ofertas.xml.gz</loc>\r\n  <lastmod>` + date +` </lastmod>\r\n</sitemap>\r\n</sitemapindex>`;\r\n\r\n  fs.writeFile(config.paths.static + '/sitemaps/sitemap.xml', content, 'utf8', function(err) {\r\n    if (err) {\r\n      return console.log(err);\r\n    }\r\n    console.log('Index sitemap is created :=)');\r\n  });\r\n}\r\n\r\n\r\nmodule.exports = {\r\n  index: smIndex,\r\n  pages: smPages,\r\n  offers: smOffers\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/create-sitemap.js","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"express-preconditions\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-preconditions\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"node-cron\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-cron\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 15\n// module chunks = 0","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar crudFn = require('../db/crud.js');\nvar ITEMS_PER_PAGE = 6;\nvar COLLECTION = 'categories';\n\nvar crudInst;\nvar conf;\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = crudFn({\n      db:db\n    });\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  })\n  .then(function(){\n    if(crudInst) {\n      _id();\n      index()\n    } else {\n      indexNoDB();\n    }\n    \n  });\n\n  return router;\n};\n\nfunction _id() {\n  router.get('/categories/:_id', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.mainCollection,\n        query: { categories: req.params._id },\n        items_per_page: ITEMS_PER_PAGE,\n        skip: ITEMS_PER_PAGE*page,\n        sort: { _id: -1},\n        projection: {name: 1, thumbnail: 1, store_id: 1, slug: 1, img_alt: 1, img_title: 1}\n      }),\n      crudInst.getItem({\n        collection:  COLLECTION,\n        query: {_id: req.params._id},\n        projection: {name:1, thumbnail: 1, slug: 1, content: 1, img: 1, img_alt: 1, img_title: 1}\n      }),\n      crudInst.getPagination({\n        query: { store_id: req.params._id },\n        collection: conf.db.mainCollection\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          info: results[1],\n          pagination: results[2]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\nfunction index() {\n  router.get('/categories', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: COLLECTION,\n        items_per_page: ITEMS_PER_PAGE, \n        skip: ITEMS_PER_PAGE*page,\n        sort: { name: 1},\n        projection: { name: 1, slug: 1, thumbnail: 1, img_alt:1, img_title: 1 }\n      }),\n      crudInst.getPagination({\n        collection: COLLECTION\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          pagination: results[1]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/categories.js","'use strict';\r\n\r\nvar express = require('express');\r\nvar router = express.Router();\r\nvar crudFn = require('../db/crud.js');\r\nvar ITEMS_PER_PAGE = 6;\r\nvar COLLECTION = 'offers';\r\n\r\nvar crudInst;\r\nvar conf;\r\nmodule.exports = function(wagner, params) {\r\n  wagner.invoke(function(conn, config) {\r\n    conf = config;\r\n    return conn;\r\n  })\r\n  .then(function(db){\r\n    crudInst = crudFn({\r\n      db:db\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    //some configuration to notify no database connection working\r\n    console.log(err);\r\n  })\r\n  .then(function(){\r\n    if(crudInst) {\r\n      index();  \r\n    } else {\r\n      indexNoDB();\r\n    }\r\n    \r\n  });\r\n\r\n  return router;\r\n};\r\n\r\nfunction index() {\r\n  router.get('/home', function(req, res) {\r\n    var page = req.query.page ? Number(req.query.page) : 0;\r\n    var iterable = [\r\n      crudInst.getItems({\r\n        collection: COLLECTION,\r\n        items_per_page: ITEMS_PER_PAGE, \r\n        skip: ITEMS_PER_PAGE*page,\r\n        sort: { _id: -1},\r\n        projection: { name: 1, thumbnail: 1, store_id: 1, slug: 1, img_alt:1, img_title: 1, title: 1 }\r\n      }),\r\n      crudInst.getPagination({\r\n        collection: COLLECTION,\r\n      })\r\n    ];\r\n\r\n    Promise.all(iterable)\r\n    .then(function(results) {\r\n      res.json({\r\n          items: results[0],\r\n          pagination: results[1]\r\n        });\r\n    })\r\n    .catch(function(error) {\r\n      res.json(error);\r\n    });\r\n  });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/home.js","'use strict';\r\n\r\nvar express = require('express');\r\nvar router = express.Router();\r\nvar crudFn = require('../db/crud.js');\r\n\r\nvar crudInst;\r\nvar conf;\r\nmodule.exports = function(wagner, params) {\r\n  wagner.invoke(function(conn, config) {\r\n    conf = config;\r\n    return conn;\r\n  })\r\n  .then(function(db){\r\n    crudInst = crudFn({\r\n      db:db\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    //some configuration to notify no database connection working\r\n    console.log(err);\r\n  })\r\n  .then(function(){\r\n    if(crudInst) {\r\n      slug();  \r\n    }    \r\n  });\r\n\r\n  return router;\r\n};\r\n\r\nfunction slug() {\r\n  router.get('/promotions/:slug', function(req, res) {\r\n    var iterable = [\r\n      crudInst.getItem({\r\n        collection: conf.db.mainCollection,\r\n        query: { slug: req.params.slug },\r\n        items_per_page: 1,\r\n        sort: { _id: -1},\r\n        projection: { name: 1, thumbnail: 1, store_id: 1, categories: 1, slug: 1, content: 1, url: 1, img: 1, modified: 1, img_alt: 1, img_title: 1}\r\n      })\r\n    ];\r\n\r\n    return Promise.all(iterable)\r\n          .then(function(results) {\r\n            res.json({\r\n                item: results[0]\r\n              });\r\n          })\r\n          .catch(function(error) {\r\n            res.json(error);\r\n          });\r\n        });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/promotions.js","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar crudFn = require('../db/crud.js');\nvar ITEMS_PER_PAGE = 6;\nvar COLLECTION = 'stores';\n\nvar crudInst;\nvar conf;\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = crudFn({\n      db:db\n    });\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  })\n  .then(function(){\n    if(crudInst) {\n      _id();\n      index();\n    }\n  });\n\n  return router;\n};\n\nfunction _id() {\n  router.get('/stores/:_id', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.mainCollection,\n        query: { store_id: req.params._id },\n        items_per_page: ITEMS_PER_PAGE,\n        skip: ITEMS_PER_PAGE*page,\n        sort: { _id: -1},\n        projection: {name: 1, thumbnail: 1, store_id: 1, slug: 1, img: 1, img_alt:1, img_title:1 }\n      }),\n      crudInst.getItem({\n        collection:  COLLECTION,\n        query: {_id: req.params._id},\n        projection: {name:1, thumbnail: 1, slug: 1, url_site: 1, content: 1, img: 1, img_alt:1, img_title: 1}\n      }),\n      crudInst.getPagination({\n        query: { store_id: req.params._id },\n        collection: conf.db.mainCollection\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          info: results[1],\n          pagination: results[2]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\nfunction index() {\n  router.get('/stores', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: COLLECTION,\n        items_per_page: ITEMS_PER_PAGE, \n        skip: ITEMS_PER_PAGE*page,\n        sort: { name: 1},\n        projection: { name: 1, slug: 1, thumbnail: 1, img_alt:1, img_title:1 }\n      }),\n      crudInst.getPagination({\n        collection: COLLECTION\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          pagination: results[1]\n        });\n    })\n    .catch(function(error) {\n      console.log(error);\n      res.json(error);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/stores.js","var wagner = require('wagner-core');\r\nvar sm = require('sitemap')\r\nvar config = require('../../config.js')(wagner);\r\nrequire('../../db/connection.js')(wagner);\r\nvar crud = require('../../db/crud.js');\r\nvar fs = require('fs');\r\nvar zlib = require('zlib');\r\n\r\nfunction getDate () {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction getData (params) {\r\n  return wagner.invoke(function(conn) {\r\n      return conn;\r\n    }).then(function(db) {\r\n      return crud({ db: db });\r\n    }).then(function(crud){\r\n      return crud.getItems({\r\n          collection: params.collection || 'offers',\r\n          query: params.query || {},\r\n          projection: params.projection || { slug: 1, modified: 1 },\r\n          items_per_page: params.items_per_page || 10000\r\n        })\r\n    });\r\n}\r\n\r\nfunction compress(path) {\r\n  var readable = fs.createReadStream(path);\r\n  var writable = fs.createWriteStream(path + '.gz');\r\n  var gzip = zlib.createGzip();\r\n  readable.pipe(gzip).pipe(writable);\r\n  gzip.on('end', function () {\r\n    writable.end();\r\n    console.log(path + ' sitemap file is compressed!!');\r\n  });\r\n}\r\n\r\nfunction createSitemap () {\r\n  var sitemap = sm.createSitemap({\r\n    hostname: config.host,\r\n    xmlNs: `xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\r\n      xmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\"\r\n      xmlns:video=\"http://www.google.com/schemas/sitemap-video/1.1\"\r\n      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n      xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\r\n      xsi:schemaLocation=\"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd\"`\r\n  });\r\n\r\n  return sitemap\r\n}\r\n\r\nfunction addToSitemap(sitemap, data, params) {\r\n  data.forEach(function(current) {\r\n    sitemap.add({\r\n      url: params.route + '/' + current.slug,\r\n      changefreq: params.changefreq || 'daily',\r\n      priority: params.priority || 0.5,\r\n      lastmodISO: current.modified || getDate()\r\n    });\r\n  });\r\n\r\n  return sitemap\r\n}\r\n\r\nfunction createSitemapFile (sitemap, params) {\r\n  fs.writeFile(params.sitemap_path, sitemap.toString(), function(err) {\r\n    if (err) {\r\n      return console.log(err);\r\n    }\r\n    console.log(params.sitemapName + ' sitemap has been created!!');\r\n    compress(params.sitemap_path);\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  createSitemap: createSitemap,\r\n  createSitemapFile: createSitemapFile,\r\n  compress: compress,\r\n  addToSitemap: addToSitemap,\r\n  getData: getData,\r\n  getDate: getDate\r\n} \n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/utils.js","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"zlib\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"zlib\"\n// module id = 23\n// module chunks = 0","import Nuxt from 'nuxt'\nimport express from 'express'\nimport compression from 'compression'\nvar cron = require('node-cron');\nvar csm = require('./utils/sitemaps/create-sitemap.js');\nvar preconditions = require('express-preconditions')\nvar helmet = require('helmet')\n\n\nimport api from './api'\n\nvar bodyParser = require('body-parser');\n\nconst app = express()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\n\napp.set('port', port)\n\n// Import API Routes\napp.use('/api', api)\napp.use(preconditions())\napp.use(helmet())\n//Security\napp.disable('x-powered-by');\n\n// Import and Set Nuxt.js options\nlet nuxtConfig = require('../nuxt.config.js')\nnuxtConfig.dev = !(process.env.NODE_ENV === 'production')\n\n// Init Nuxt.js\nconst nuxt = new Nuxt(nuxtConfig)\n//before nuxt render to compress data\napp.set('view cache', true);//Cache template compilation\napp.use(compression());//Compress all the data that the server response\n\n//At the end because it won't call next()\napp.use(nuxt.render)\n\n// Build only in dev mode\nif (nuxtConfig.dev) {\n  nuxt.build()\n  .catch((error) => {\n    console.error(error) // eslint-disable-line no-console\n    process.exit(1)\n  })\n}\n\n// Listen the server\napp.listen(port)\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n\ncron.schedule('5 0 * * *', function (){//run every 5 minutes after midnigh everyday\n  csm.pages();\n});\n\ncron.schedule('5 0,6,12,18 * * *', function () {//run every 6 hours\n  csm.offers();\n});\n\ncron.schedule('5 0 * * *', function () {//run every 5 minutes after midnigh everyday\n  csm.index();\n});\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}