{"version":3,"sources":["webpack:///webpack/bootstrap edd476c2dda6ed7807e1","webpack:///external \"express\"","webpack:///./server/config.js","webpack:///./server/db/crud.js","webpack:///./server/utils/index.js","webpack:///external \"fs\"","webpack:///external \"path\"","webpack:///./server/utils/sitemaps/create-sitemap.js","webpack:///external \"wagner-core\"","webpack:///./server/db/connection.js","webpack:///external \"node-cron\"","webpack:///external \"request\"","webpack:///external \"sitemap\"","webpack:///./nuxt.config.js","webpack:///./server/api/index.js","webpack:///./server/utils/sitemaps/schedule.js","webpack:///external \"body-parser\"","webpack:///external \"compression\"","webpack:///external \"helmet\"","webpack:///external \"morgan\"","webpack:///external \"nuxt\"","webpack:///external \"rotating-file-stream\"","webpack:///./server/api/categories.js","webpack:///./server/api/home.js","webpack:///./server/api/promotions.js","webpack:///./server/api/seo.js","webpack:///./server/api/stores.js","webpack:///./server/api/upload.js","webpack:///./server/utils/feed/feed.js","webpack:///./server/utils/feed/index.js","webpack:///./server/utils/pn/index.js","webpack:///./server/utils/sitemaps/utils.js","webpack:///external \"jimp\"","webpack:///external \"mkdirp\"","webpack:///external \"mongodb\"","webpack:///external \"multer\"","webpack:///external \"striptags\"","webpack:///external \"xml\"","webpack:///external \"zlib\"","webpack:///./server/index.js"],"names":["path","require","config","db","user","password","name","host","shard1","shard2","shard3","queryString","mainCollection","itemsPerPage","collections","main","secundary","categories","pages","seo","routes","categoriesList","stores","storeList","paths","root","resolve","__dirname","server","static","xml","feed","app_status","module","exports","wagner","factory","CRUD","params","COLLECTION","collection","DATABASE","ITEMS_PER_PAGE","items_per_page","prototype","getItems","cursor","find","query","projection","sort","skip","limit","toArray","then","docs","catch","err","getItem","setItem","insertOne","document","res","updateOne","update","options","searchItems","score","$meta","getPagination","that","count","numItems","numPages","Math","ceil","total","aggregation","aggregate","data","Crud","getCrud","invoke","conn","formatDateStr","date","format","dateStr","Date","toUpperCase","toGMTString","split","toISOString","getDate","dateObj","substract","getTime","checkIfNewOffers","crud","published","doc","lastOfferDate","lastOfferDateTime","hours","minus12hrsDateTime","minus12hrsDate","resp","lastOffer","news","utils","smUtils","sm","fs","request","rootXml","offers","pages_name","stores_name","categories_name","getData","slug","modified","img","img_title","img_alt","smPages","compoundSitemap","createSitemap","add","url","changefreq","priority","lastmodISO","addToSitemap","route","algo","createSitemapFile","sitemap_path","sitemapName","smCategories","smStores","smOffers","offersSitemap","smIndex","iterable","Promise","reject","stat","all","results","content","mtime","writeFile","console","log","Error","compress","ping","error","response","body","index","MongoClient","getConnection","connect","loading","color","height","cache","head","htmlAttrs","lang","title","meta","charset","link","rel","type","href","sizes","__dangerouslyDisableSanitizers","plugins","src","ssr","build","vendor","extend","ctx","isClient","rules","push","enforce","test","loader","exclude","home","promotions","upload","router","Router","use","cron","csm","schedule","express","crudInst","conf","_id","indexNoDB","get","req","page","Number","thumbnail","img_data","json","items","info","pagination","pn","getFormDataPromotions","savePromotion","$set","item","allStores","allCategories","updateStoresAndCategories","map","currCat","forEach","currStore","updateSitemaps","length","sendPushNotification","message","meta_description","operation","cb","urls","create","post","rightNow","missingData","Object","assign","dbResponse","result","ok","multi","save","id","dbRes","upsert","createStore","url_site","mkdirp","jimp","rootPathUploads","getPath","file","finalPath","join","getFullYear","getMonth","multerUpload","files","originalName","originalname","extension","filePath","finalRootPath","read","scaleToFit","quality","write","success","msg","storage","multer","diskStorage","destination","callback","pathFile","mkdirPromise","filename","array","GENERATOR","DOCTYPE","Feed","contributors","category","contributor","warn","atom1","rss2","_attr","xmlns","updated","generator","author","email","uri","atomLink","feedLinks","atom","hub","description","subtitle","image","logo","favicon","icon","copyright","rights","term","entry","_cdata","summary","Array","isArray","oneAuthor","isAtom","isContent","channel","lastBuildDate","rss","version","guid","pubDate","some","enclosure","home_page_url","feed_url","feedItem","html_content","date_modified","date_published","JSON","stringify","d","pad","n","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","striptags","rootFeed","feedXml","slice","addItem","apiKey","headers","method","form","on","status","request_id","statusCode","statusMessage","zlib","readable","createReadStream","writable","createWriteStream","gzip","createGzip","pipe","sitemap","hostname","xmlNs","current","obj","caption","toString","end","develop","app","process","env","HOST","port","PORT","morganFormat","logDirectory","existsSync","mkdirSync","accessLogStream","rfs","interval","set","bodyParser","morgan","stream","helmet","disable","nuxtConfig","dev","nuxt","compression","render","exit","listen","sitemapSchedule"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 38);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap edd476c2dda6ed7807e1","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","var path = require('path');\r\n\r\nvar config = {\r\n  db: {\r\n    user: 'ofertadeo',\r\n    password: 'Cdo_2017*',\r\n    name: 'ofertadeo',\r\n    host: 'ds161471.mlab.com:61471',\r\n    shard1: 'pensemosweb-shard-00-00-147ev.mongodb.net:27017',\r\n    shard2: 'pensemosweb-shard-00-01-147ev.mongodb.net:27017',\r\n    shard3: 'pensemosweb-shard-00-02-147ev.mongodb.net:27017',\r\n    queryString: '?ssl=true&replicaSet=pensemosweb-shard-0&authSource=admin',\r\n    mainCollection: 'offers',\r\n    itemsPerPage: 18,\r\n    collections: {\r\n      main: 'offers',\r\n      secundary: 'stores',\r\n      categories: 'categories',\r\n      pages: 'pages',\r\n      seo: 'seo'\r\n    }\r\n  },\r\n  routes: {\r\n    categories: '/categorias',\r\n    categoriesList: '/categorias',\r\n    stores: '/promociones',\r\n    main: '/promociones',\r\n    storeList: '/tiendas'\r\n  },\r\n  host: 'http://45.55.71.33',\r\n  paths: {\r\n    root: path.resolve(__dirname, '../'),\r\n    server: __dirname,\r\n    static: path.resolve(__dirname, '../static'),\r\n    xml: '/home/jaime/xml',\r\n    feed: '/home/jaime/static/feed'\r\n  },\r\n  app_status: 'develop'\r\n};\r\n\r\nmodule.exports = function (wagner) {\r\n  if (wagner) {\r\n    wagner.factory('config', function () {\r\n      return config;\r\n    });\r\n  };\r\n  return config;\r\n};\r\n\r\nmodule.exports.config = config;\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","'use strict';\nvar config = require('../config').config;\n\nmodule.exports = CRUD;\n\nfunction CRUD(params) {\n  this.COLLECTION = params.collection;\n  this.DATABASE = params.db;\n  this.ITEMS_PER_PAGE = params.items_per_page || config.db.itemsPerPage;\n};\n\nCRUD.prototype.getItems = function (params) {\n  var db = this.DATABASE || params.db;\n  var items_per_page = params.items_per_page || this.ITEMS_PER_PAGE;\n  var cursor = db.collection(this.COLLECTION || params.collection)\n    .find(params.query || {}, params.projection || {} );\n\n  if (params.sort) {\n    cursor.sort(params.sort);\n  }\n\n  if (params.skip) {\n    cursor.skip(params.skip);\n  }\n  \n  return cursor.limit(items_per_page)\n    .toArray()\n    .then(function(docs) {\n      if (items_per_page > 1) {\n        return docs;\n      } else {\n        return docs[0];\n      }\n    })\n    .catch(function(err) {\n      return err;\n    });\n};\n\nCRUD.prototype.getItem = function (params) {\n  params.items_per_page = 1;\n  return this.getItems(params);\n};\n\nCRUD.prototype.setItem = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(params.collection || this.COLLECTION)\n    .insertOne(params.document)\n    .then(function(res) {\n      return res;\n    })\n    .catch(function(err) {\n      return err;\n    });\n}\n\nCRUD.prototype.updateOne = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(params.collection || this.COLLECTION)\n  .updateOne(params.query, params.update)\n  .then(function(res) {\n    return res;\n  })\n  .catch(function(err) {\n    return err;\n  });\n}\n\nCRUD.prototype.update = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(params.collection || this.COLLECTION)\n  .update(params.query, params.update, params.options)\n  .then(function(res) {\n    return res;\n  })\n  .catch(function(err) {\n    return err;\n  });\n}\n\nCRUD.prototype.searchItems = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(this.COLLECTION || params.collection)\n    //we project the textScore meta data and then we sort the results by the best matches first\n    .find(params.query, params.projection || { score: { $meta: 'textScore'} })\n    .sort(params.sort || { score: { $meta: 'textScore'} })\n    .skip(params.skip || 0)\n    .limit(params.items_per_page || this.ITEMS_PER_PAGE)\n    .toArray()\n    .then(function(docs) {\n      return docs;\n    })\n    .catch(function(err) {\n      return err;\n    });\n};\n\nCRUD.prototype.getPagination = function (params) {\n  var that = this;\n  var db = that.DATABASE || params.db;\n  return db.collection(this.COLLECTION || params.collection)\n    .count(params.query || {})\n    .then(function(numItems){\n      var items_per_page = params.items_per_page || that.ITEMS_PER_PAGE;\n      var numPages = 0;\n      if (numItems > items_per_page ) {\n        numPages = Math.ceil(numItems/items_per_page);\n      }\n      return {\n        pages: numPages,\n        total: numItems\n      };\n    })\n    .catch(function(err){\n      return err;\n    });\n};\n\nCRUD.prototype.aggregation = function (params) {\n  var db = this.DATABASE || params.db;\n  return db.collection(this.COLLECTION || params.collection)\n    .aggregate(params.aggregation)\n    .toArray()\n    .then(function(data){\n      return data\n    })\n    .catch(function(err){\n      return err\n    });\n};\n\n\n// WEBPACK FOOTER //\n// ./server/db/crud.js","var config = require('../config.js').config;\nvar wagner = require('wagner-core');\nvar Crud = require('../db/crud.js');\n\nrequire('../config.js')(wagner)\nrequire('../db/connection.js')(wagner);\n\nfunction getCrud() {\n  return wagner\n  .invoke(function(conn){\n    return conn;\n  })\n  .then(function(conn){\n    return new Crud({ db: conn });\n  });\n}\n\nfunction formatDateStr(date, format){\n  var dateStr = new Date(date);\n  if (format && format.toUpperCase() === 'GMT') {\n    return dateStr.toGMTString().split('GMT')[0] + '-0500';\n  }\n  return  dateStr.toISOString().split('.')[0] + '-05:00' ;\n}\n\nfunction getDate (dateObj, format) {\n  var date;\n  if(dateObj) {\n    date = new Date(dateObj);\n  } else {\n    date = new Date();\n  }\n  \n  var substract = date.getTime() - (300*60*1000);// minus 5 hrs\n  \n  return formatDateStr(substract, format );\n}\n\nfunction checkIfNewOffers () {\n  return getCrud()\n  .then(function(crud){\n    return crud.getItem({\n      collection: config.db.collections.main,\n      query: {},\n      sort: { published: -1 },\n      projection: { published: 1 }\n    });\n  })\n  .then(function(doc){\n    let lastOfferDate = new Date(doc.published);\n    let lastOfferDateTime = new Date(doc.published).getTime();\n    let hours = 12*60*60*1000;\n    let minus12hrsDateTime = new Date().getTime() - hours;\n    let minus12hrsDate = new Date(minus12hrsDateTime);\n    let resp = {\n      lastOffer: doc.published,\n      lastOfferDate: getDate(lastOfferDate),\n      lastOfferDateTime: lastOfferDateTime,\n      minus12hrsDate: getDate(minus12hrsDate),\n      minus12hrsDateTime: minus12hrsDateTime,\n      news: false\n    };\n\n    if(lastOfferDateTime >= minus12hrsDateTime) {\n      resp.news = true;\n      return resp;\n    }\n\n    return resp;\n  });\n}\n\n\nmodule.exports = {\n  getDate: getDate,\n  checkIfNewOffers: checkIfNewOffers,\n  getCrud: getCrud\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","var utils = require('../index.js');\r\nvar smUtils = require('./utils.js');\r\nvar config = require('../../config')();\r\nvar sm = require('sitemap')\r\nvar fs = require('fs');\r\nvar request = require('request');\r\nvar rootXml = config.paths.xml;\r\nvar offers = 'sitemap-offers.xml';\r\nvar pages_name = 'sitemap-pages.xml';\r\nvar stores_name = 'sitemap-stores.xml';\r\nvar categories_name = 'sitemap-categories.xml';\r\n\r\n\r\nfunction getData (params) {\r\n  return utils.getCrud()\r\n    .then(function(crud){\r\n      return crud.getItems({\r\n          collection: params.collection || config.db.collections.main,\r\n          query: params.query || {},\r\n          projection: params.projection || { slug: 1, modified: 1, img: 1, img_title: 1, img_alt: 1 },\r\n          items_per_page: params.items_per_page || 10000,\r\n          sort: { published: -1 }\r\n        }).catch(function(err) {\r\n          return err;\r\n        });\r\n    })\r\n    .catch(function(err){\r\n      return err;\r\n    });\r\n}\r\n\r\nfunction smPages () {\r\n  var modified = utils.getDate();\r\n  var compoundSitemap = smUtils.createSitemap();\r\n  \r\n  compoundSitemap.add({url: '/', changefreq: 'daily', priority: 1.0, lastmodISO: modified});\r\n\r\n  return getData({ collection: config.db.collections.pages })\r\n  .then(function(data) {\r\n    return smUtils.addToSitemap(compoundSitemap, data,  {\r\n      route: '',\r\n      changefreq: 'weekly',\r\n      priority: 0.7\r\n    });\r\n  })\r\n  .then(function(algo){\r\n    return smUtils.createSitemapFile(compoundSitemap, {\r\n      sitemap_path: rootXml + '/' + pages_name,\r\n      sitemapName: pages_name\r\n    });    \r\n  })\r\n  .catch(function(err) {\r\n    return err;\r\n  });\r\n}\r\n\r\nfunction smCategories () {\r\n  var smCategories = smUtils.createSitemap();\r\n  return getData( { collection: config.db.collections.categories } )\r\n  .then(function(data) {\r\n     smUtils.addToSitemap(smCategories, data,  {\r\n      route: config.routes.categories,\r\n      changefreq: 'weekly',\r\n      priority: 0.9\r\n    });\r\n  })\r\n  .then(function() {\r\n    return smUtils.createSitemapFile(smCategories, {\r\n      sitemap_path: rootXml + '/' + categories_name,\r\n      sitemapName: categories_name\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    return err;\r\n  });\r\n}\r\n\r\nfunction smStores () {\r\n  var smStores = smUtils.createSitemap();\r\n  return getData( { collection: config.db.collections.secundary } )  \r\n  .then(function(data) {\r\n    return smUtils.addToSitemap(smStores, data,  {\r\n      route: config.routes.storeList,\r\n      changefreq: 'weekly',\r\n      priority: 0.9\r\n    });\r\n  })\r\n  .then(function() {\r\n    return smUtils.createSitemapFile(smStores, {\r\n      sitemap_path: rootXml + '/' + stores_name,\r\n      sitemapName: stores_name\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    return err;\r\n  });\r\n}\r\n\r\nfunction smOffers () {\r\n  var offersSitemap = smUtils.createSitemap();\r\n\r\n  return getData({collection: config.db.collections.main })\r\n  .then(function (data) {\r\n    smUtils.addToSitemap(offersSitemap, data, {\r\n      route: config.routes.main,\r\n      changefreq: 'monthly',\r\n      priority: 0.5\r\n    });\r\n  })\r\n  .then(function() {\r\n    return smUtils.createSitemapFile(offersSitemap, {\r\n      sitemap_path: rootXml + '/' + offers,\r\n      sitemapName: offers\r\n    });\r\n  })\r\n  .catch(function(err) {\r\n    return err;\r\n  });\r\n}\r\n\r\nfunction smIndex () {\r\n\r\n  let iterable = [\r\n    new Promise(function(resolve, reject){\r\n      fs.stat(`${rootXml}/${pages_name}.gz`, function(err, stat) {\r\n        if(err) {\r\n          reject(err);\r\n        }\r\n        resolve(stat)\r\n      });\r\n    }),\r\n    new Promise(function(resolve, reject){\r\n      fs.stat(`${rootXml}/${offers}.gz`, function(err, stat) {\r\n        if(err) {\r\n          reject(err);\r\n        }\r\n        resolve(stat)\r\n      });\r\n    }),\r\n    new Promise(function(resolve, reject){\r\n      fs.stat(`${rootXml}/${stores_name}.gz`, function(err, stat) {\r\n        if(err) {\r\n          reject(err);\r\n        }\r\n        resolve(stat)\r\n      });\r\n    }),\r\n    new Promise(function(resolve, reject){\r\n      fs.stat(`${rootXml}/${categories_name}.gz`, function(err, stat) {\r\n        if(err) {\r\n          reject(err);\r\n        }\r\n        resolve(stat)\r\n      });\r\n    })\r\n  ];\r\n\r\n\r\n  return new Promise(function(resolve, reject) {\r\n    Promise.all(iterable)\r\n    .then(function(results){\r\n      var content = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n        <sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\r\n        <sitemap>\r\n          <loc>${config.host}/${pages_name}.gz</loc>\r\n          <lastmod>${utils.getDate(results[0].mtime)}</lastmod>\r\n        </sitemap>\r\n        <sitemap>\r\n          <loc>${config.host}/${offers}.gz</loc>\r\n          <lastmod>${utils.getDate(results[1].mtime)}</lastmod>\r\n        </sitemap>\r\n        <sitemap>\r\n          <loc>${config.host}/${stores_name}.gz</loc>\r\n          <lastmod>${utils.getDate(results[2].mtime)}</lastmod>\r\n        </sitemap><sitemap>\r\n          <loc>${config.host}/${categories_name}.gz</loc>\r\n          <lastmod>${utils.getDate(results[3].mtime)}</lastmod>\r\n        </sitemap>\r\n        </sitemapindex>`;\r\n\r\n      fs.writeFile(rootXml + '/sitemap.xml', content, 'utf8', function(err) {\r\n        if (err) {\r\n          console.log(Error(err));\r\n          reject(Error(err));\r\n        }\r\n        smUtils.compress(rootXml + '/sitemap.xml');\r\n        console.log('Index sitemap is created :=)');\r\n        resolve('Index sitemap is created :=)');\r\n      });\r\n    })\r\n    .catch(function(err){\r\n      console.log(Error(err));\r\n      reject(err);\r\n    });\r\n  });\r\n}\r\n\r\nfunction ping () {\r\n  if(config.app_status === 'deploy') {\r\n    request('https://www.google.com/webmasters/sitemaps/ping?sitemap=https://www.ofertadeo.com/sitemap.xml', function(error, response, body) {\r\n      if(error) {\r\n        console.log('------------------------------------------');\r\n        console.log(utils.getDate());\r\n        console.log('error: ', error);\r\n        console.log('------------------------------------------');\r\n        return;\r\n      }\r\n      console.log('------------------------------------------');\r\n      console.log(utils.getDate());\r\n      console.log('success ping to GOOGLE sitemap!!:');\r\n      console.log('------------------------------------------');\r\n      console.log(body);\r\n    });\r\n\r\n    request('https://www.bing.com/webmaster/ping.aspx?siteMap=https://www.ofertadeo.com/sitemap.xml', function(error, response, body) {\r\n      if(error) {\r\n        console.log('------------------------------------------');\r\n        console.log(utils.getDate());\r\n        console.log('error: ', error);\r\n        console.log('------------------------------------------');\r\n        return;\r\n      }\r\n      console.log('------------------------------------------');\r\n      console.log(utils.getDate());\r\n      console.log('success ping to BING sitemap!!:');\r\n      console.log('------------------------------------------');\r\n      console.log(body);\r\n    });\r\n  }\r\n}\r\n\r\n\r\nmodule.exports = {\r\n  index: smIndex,\r\n  pages: smPages,\r\n  offers: smOffers,\r\n  stores: smStores,\r\n  categories: smCategories,\r\n  ping: ping\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/create-sitemap.js","module.exports = require(\"wagner-core\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"wagner-core\"\n// module id = 7\n// module chunks = 0","'use strict';\r\n\r\nvar MongoClient = require('mongodb').MongoClient;\r\n \r\nfunction getConnection(config) {\r\n  //connPromise is pending when trying to connect to mongodb atlas\r\n  // var shards = config.db.shard1 + ',' + config.db.shard2 + ',' + config.db.shard3;\r\n  // var url = 'mongodb://' + config.db.user + ':' + config.db.password + '@' + shards + '/' + config.db.name + config.db.queryString;\r\n  var url = 'mongodb://' + config.db.user + ':' + config.db.password + '@' + config.db.host + '/' + config.db.name;\r\n\r\n  return MongoClient.connect(url).then(function(conn){\r\n      console.log('It is connected to db: ' + config.db.name + ' in ' + config.db.host );\r\n      return conn;\r\n    })\r\n    .catch(function(err) {\r\n      console.log(err);\r\n      return err;\r\n    });\r\n}\r\n\r\nmodule.exports = function(wagner) {\r\n  wagner.invoke(function(config) {\r\n    var conn = getConnection(config);\r\n    wagner.factory('conn', function() {\r\n      return conn;\r\n    });\r\n  });\r\n  \r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/db/connection.js","module.exports = require(\"node-cron\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-cron\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"request\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"sitemap\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sitemap\"\n// module id = 11\n// module chunks = 0","module.exports = {\n  loading: {\n    color: '#ff80ab',\n    height: '11px'\n  },\n  cache: true,\n  /*\n  ** Headers of the page\n  */\n  head: {\n    htmlAttrs: {\n      lang: 'es-MX'\n    },\n    title: 'Ofertas, promociones y descuentos en México | Ofertadeo',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { name: 'theme-color', content:'#1976d2' },\n      { name: 'msapplication-TileColor', content: '#2d89ef' },\n      { name: 'msapplication-TileImage', content: '/favicons/mstile-144x144.png' },\n      { name: 'msapplication-config', content: '/favicons/browserconfig.xml' },\n      { name: 'p:domain_verify', content: 'd22a77a044a4490ebd5019e778f4a37b' },\n      { name: 'google-site-verification', content: '-jN3QPeaXQTbgPBlyAXlXXh7qRSesWIpa3GC3ijTjJM' },\n      { name: 'msvalidate.01', content: '162D9E28E432D290B43E41702E108642' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicons/favicon.ico' },\n      { rel: 'apple-touch-icon', sizes: '180x180', href: '/favicons/apple-touch-icon.png' },\n      { rel: 'icon', type: 'image/png', sizes: '32x32', href: '/favicons/favicon-32x32.png' },\n      { rel: 'icon', type: 'image/png', sizes: '16x16', href: '/favicons/favicon-16x16.png' },\n      { rel: 'manifest', href: '/favicons/manifest.json'},\n      { rel: 'mask-icon', href: '/favicons/safari-pinned-tab.svg', color: '#1976d2' },\n      { rel: 'shortcut icon', href: '/favicons/favicon.ico' },\n      { rel: 'dns-prefetch', href:'//www.google-analytics.com' }\n    ],\n    __dangerouslyDisableSanitizers: ['script']\n  },\n  /*\n  ** Global CSS\n  */\n   plugins: [\n      { src: '~plugins/ga.js', ssr: false },\n   ],\n  /*\n  ** Add axios globally\n  */\n  build: {\n    vendor: ['axios','~plugins/striptags.js'],\n    /*\n    ** Run ESLINT on save\n    */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import { Router } from 'express'\nvar wagner = require('wagner-core');\nvar home = require('./home');\nvar categories = require('./categories');\nvar stores = require('./stores');\nvar promotions = require('./promotions');\nvar upload = require('./upload');\nvar seo = require('./seo');\n\nrequire('../config.js')(wagner);\nrequire('../db/connection.js')(wagner);\n\nvar router = Router()\nrouter.use(home(wagner))\nrouter.use(categories(wagner))\nrouter.use(stores(wagner))\nrouter.use(promotions(wagner))\nrouter.use(upload(wagner))\nrouter.use(seo(wagner))\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/index.js","var cron = require('node-cron');\r\nvar csm = require('./create-sitemap.js');\r\nvar utils = require('../index.js');\r\n\r\nvar schedule = {\r\n\tping: ping\r\n};\r\n\r\n\r\nfunction ping () {\r\n\t//cron.schedule('*/1 * * * *', function (){\r\n\tcron.schedule('1 12 * * *', function (){ //run every day at 12:00 hrs\r\n\t  utils\r\n\t  .checkIfNewOffers()\r\n\t  .then(function(res) {\r\n\t  \tconsole.log('sitemaps');\r\n\t  \tif(res && res.news) {\r\n\t  \t\tcsm.ping();\r\n\t  \t}\r\n\t  \tconsole.log(res);\r\n\t  }).catch(function(err) {\r\n\t  \tconsole.log(err);\r\n\t  });\r\n\t});\r\n\r\n\t//cron.schedule('*/1 * * * *', function (){\r\n\tcron.schedule('50 23 * * *', function () {//run every day at 23:50 hours\r\n\t\t\tutils\r\n\t  \t.checkIfNewOffers()\r\n\t\t\t.then(function(res) {\r\n\t\t\t\tconsole.log('sitemaps');\r\n\t\t  \tif(res && res.news) {\r\n\t\t  \t\tconsole.log(res);\r\n\t\t  \t\tcsm.ping();\r\n\t\t  \t}\r\n\t\t  }).catch(function(err) {\r\n\t\t  \tconsole.log(err);\r\n\t\t  });\r\n\t});\t\r\n}\r\n\r\nmodule.exports = schedule\n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/schedule.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 15\n// module chunks = 0","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"helmet\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"helmet\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"rotating-file-stream\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rotating-file-stream\"\n// module id = 20\n// module chunks = 0","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\n\nvar crudInst;\nvar conf;\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .then(function(){\n    if(crudInst) {\n      _id();\n      index()\n    } else {\n      indexNoDB();\n    }\n  })\n  .catch(function(err) {\n    console.log(error);\n  });\n\n  return router;\n};\n\nfunction _id() {\n  router.get('/categories/:_id', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.main,\n        query: { 'categories._id': req.params._id },\n        items_per_page: conf.db.itemsPerPage,\n        skip: conf.db.itemsPerPage*page,\n        sort: { published: -1},\n        projection: {\n          name: 1,\n          thumbnail: 1,\n          stores: 1,\n          slug: 1,\n          img: 1,\n          img_data: 1,\n          img_alt: 1,\n          img_title: 1,\n          published: 1,\n          modified: 1\n        }\n      }),\n      crudInst.getItem({\n        collection:  conf.db.collections.categories,\n        query: {_id: req.params._id},\n        projection: {name:1, thumbnail: 1, slug: 1, content: 1, img: 1, img_alt: 1, img_title: 1, img_data: 1}\n      }),\n      crudInst.getPagination({\n        query: { 'categories._id': req.params._id },\n        collection: conf.db.collections.main\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          info: results[1],\n          pagination: results[2]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\nfunction index() {\n  router.get('/categories', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.categories,\n        items_per_page: conf.db.itemsPerPage, \n        skip: conf.db.itemsPerPage*page,\n        sort: { name: 1},\n        projection: {\n          name: 1,\n          slug: 1,\n          thumbnail: 1,\n          img: 1,\n          img_data: 1,\n          img_alt:1,\n          img_title: 1,\n          published: 1,\n          modified: 1\n        }\n      }),\n      crudInst.getPagination({\n        collection: conf.db.collections.categories\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          pagination: results[1]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/categories.js","'use strict';\r\n\r\nvar express = require('express');\r\nvar router = express.Router();\r\nvar CRUD = require('../db/crud.js');\r\nvar crudInst;\r\nvar conf;\r\n\r\nmodule.exports = function(wagner, params) {\r\n  wagner.invoke(function(conn, config) {\r\n    conf = config;\r\n    return conn;\r\n  })\r\n  .then(function(db){\r\n    crudInst = new CRUD({\r\n      db:db\r\n    });\r\n  })\r\n  .then(function(){\r\n    if(crudInst) {\r\n      index();  \r\n    } else {\r\n      indexNoDB();\r\n    }\r\n    \r\n  })\r\n  .catch(function(err) {\r\n    //some configuration to notify no database connection working\r\n    console.log(err);\r\n  });\r\n\r\n  return router;\r\n};\r\n\r\nfunction index() {\r\n  router.get('/home', function(req, res) {\r\n    var page = req.query.page ? Number(req.query.page) : 0;\r\n    var iterable = [\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.main,\r\n        items_per_page: conf.db.itemsPerPage, \r\n        skip: conf.db.itemsPerPage*page,\r\n        sort: { published: -1},\r\n        projection: {\r\n          name: 1,\r\n          thumbnail: 1,\r\n          stores: 1,\r\n          slug: 1,\r\n          img: 1,\r\n          img_data: 1,\r\n          img_alt: 1,\r\n          img_title: 1,\r\n          title: 1,\r\n          published: 1,\r\n          modified: 1\r\n        }\r\n      }),\r\n      crudInst.getPagination({\r\n        collection: conf.db.collections.main\r\n      })\r\n    ];\r\n\r\n    Promise.all(iterable)\r\n    .then(function(results) {\r\n      res.json({\r\n          items: results[0],\r\n          pagination: results[1]\r\n        });\r\n    })\r\n    .catch(function(error) {\r\n      res.json(error);\r\n    });\r\n  });\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/home.js","'use strict';\r\n\r\nvar express = require('express');\r\nvar router = express.Router();\r\nvar CRUD = require('../db/crud.js');\r\nvar csm = require('../utils/sitemaps/create-sitemap.js');\r\nvar feed = require('../utils/feed/');\r\nvar pn = require('../utils/pn/');\r\n\r\nvar crudInst;\r\nvar conf;\r\nmodule.exports = function(wagner, params) {\r\n  wagner.invoke(function(conn, config) {\r\n    conf = config;\r\n    return conn;\r\n  })\r\n  .then(function(db){\r\n    crudInst = new CRUD({\r\n      db:db\r\n    });\r\n  })\r\n  .then(function(){\r\n    if(crudInst) {\r\n      slug();\r\n      getFormDataPromotions();\r\n      savePromotion('create', function (data, req){\r\n        return crudInst.setItem({ collection: conf.db.collections.main, document: data });\r\n      });\r\n      savePromotion('update', function (data, req){\r\n        return crudInst.updateOne({ collection: conf.db.collections.main, query: { slug: req.params.slug }, update: { $set: data } });\r\n      });\r\n    }    \r\n  })\r\n  .catch(function(err) {\r\n    //some configuration to notify no database connection working\r\n    console.log(err);\r\n  });\r\n\r\n  return router;\r\n};\r\n\r\nfunction slug() {\r\n  router.get('/promotions/:slug', function(req, res) {\r\n    var iterable = [\r\n      crudInst.getItem({\r\n        collection: conf.db.collections.main,\r\n        query: { slug: req.params.slug },\r\n        items_per_page: 1\r\n      })\r\n    ];\r\n\r\n    return Promise.all(iterable)\r\n          .then(function(results) {\r\n            res.json({\r\n                item: results[0]\r\n              });\r\n          })\r\n          .catch(function(error) {\r\n            res.json(error);\r\n          });\r\n        });\r\n}\r\n\r\n\r\nfunction getFormDataPromotions() {\r\n  router.get('/formdata/promotions', function(req, res) {\r\n    var iterable = [\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.secundary,\r\n        items_per_page: 100,\r\n        projection: { name: 1 },\r\n        sort: { name: 1}\r\n      }),\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.categories,\r\n        items_per_page: 100,\r\n        projection: { name: 1 },\r\n        sort: { name: 1}\r\n      })\r\n    ];\r\n\r\n    Promise.all(iterable)\r\n      .then(function(results) {\r\n        res.json({\r\n            stores: results[0],\r\n            categories: results[1]\r\n          });\r\n      })\r\n      .catch(function(error) {\r\n        res.json(error);\r\n      });\r\n  });\r\n\r\n  router.get('/formdata/promotions/:slug', function(req, res) {\r\n    var iterable = [\r\n      crudInst.getItem({\r\n        collection: conf.db.collections.main,\r\n        query: { slug: req.params.slug },\r\n        items_per_page: 1\r\n      }),\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.secundary,\r\n        items_per_page: 100,\r\n        projection: { name: 1 },\r\n        sort: { name: 1}\r\n      }),\r\n      crudInst.getItems({\r\n        collection: conf.db.collections.categories,\r\n        items_per_page: 100,\r\n        projection: { name: 1 },\r\n        sort: { name: 1}\r\n      })\r\n    ];\r\n\r\n    Promise.all(iterable)\r\n      .then(function(results) {\r\n        res.json({\r\n            item: results[0],\r\n            allStores: results[1],\r\n            allCategories: results[2]\r\n          });\r\n      })\r\n      .catch(function(error) {\r\n        res.json(error);\r\n      });\r\n  });\r\n}\r\n\r\nfunction updateStoresAndCategories (data, date) {\r\n  let iterable = data.categories.map(function(currCat) {\r\n        return crudInst.updateOne({ collection: conf.db.collections.categories, query: { _id: currCat._id }, update: { $set: { modified: date } } });\r\n      });\r\n  //We are not using map because then we have to merge with concat and left two arrays of promises running\r\n  data.stores.forEach(function(currStore){\r\n    iterable.push(crudInst.updateOne({ collection: conf.db.collections.secundary, query: { _id: currStore._id }, update: { $set: { modified: date } } }));\r\n  });\r\n\r\n  return Promise.all(iterable);\r\n}\r\nfunction updateSitemaps() {\r\n  //Update sitemaps\r\n  return new Promise(function(resolve, reject) {\r\n    return Promise.all([csm.pages(), csm.offers(), csm.stores(), csm.categories()])\r\n    .then(function(results) {\r\n      if(results && results.length > 0) {\r\n        csm.index().then(function(res){\r\n          resolve(res);\r\n        });\r\n      }\r\n    })\r\n    .catch(function(err){\r\n      reject(Error(err));\r\n    });\r\n  });  \r\n}\r\nfunction sendPushNotification(data) {\r\n  //Push notifications\r\n  pn.all({\r\n    title: data.title,\r\n    url: conf.host + conf.routes.main + '/' + data.slug,\r\n    message: data.meta_description\r\n    //@TODO: To set an image to the notifications using pushcrew, we need to create an PNG imgage 192X192\r\n    //,image_url: data.thumbnail\r\n  });\r\n}\r\nfunction savePromotion(operation, cb) {\r\n  var urls = { create: '/promotions/new', update: '/promotions/edit/:slug' };\r\n  router.post(urls[operation], function(req, res) {\r\n    var rightNow = new Date(), missingData = { modified: rightNow };\r\n    if( operation === 'create') {\r\n      missingData.published = rightNow;\r\n    }\r\n    var data = Object.assign(missingData, req.body);\r\n    cb(data, req)\r\n    .then(function(dbResponse){\r\n      res.json(dbResponse);\r\n      return dbResponse;\r\n    })\r\n    .catch(function(err){\r\n      console.log('Ocurrió un error al tratar de Guardar una promoción:');\r\n      console.log(err);\r\n      res.json(err);\r\n    })\r\n    .then(function(dbResponse){\r\n      if (dbResponse.result && dbResponse.result.ok ) {\r\n        sendPushNotification(data);\r\n        return crudInst.update({\r\n          collection: conf.db.collections.pages,\r\n          query: {},\r\n          update: { $set: { modified: rightNow } },\r\n          options: { multi: true }\r\n        })\r\n      }\r\n    })\r\n    .catch(function(err) {\r\n      console.log('Ocurrió un error al tratar de actualizar las paginas despues de guardar una promoción:')\r\n      console.log(err);\r\n    })\r\n    .then(function(dbResponse) {\r\n      if (dbResponse && dbResponse.result && dbResponse.result.ok ) {\r\n        return updateStoresAndCategories({ stores: data.stores, categories: data.categories }, rightNow);\r\n      } else {\r\n        return Error(dbResponse);\r\n      }\r\n    })\r\n    .catch(function(err) {\r\n      console.log('Ocurrió un error al tratar de actualizar tiendas y categorias despues de guardar una promoción:')\r\n      console.log(err);\r\n    })\r\n    .then(function(results) {\r\n      if(results && results.length > 0) {\r\n          //Update feed\r\n        feed.create();\r\n        return updateSitemaps();\r\n      }\r\n    })\r\n    .catch(function(err) {\r\n      console.log('Ocurrió un error al tratar de actualizar los sitemas y el feed despues de guardar una promoción:')\r\n      console.log(err);\r\n    });  \r\n  });\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/promotions.js","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\nvar crudInst;\nvar conf;\n\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .then(function(){\n    if(crudInst) {\n      save();\n      get();\n    }\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  });\n\n  return router;\n};\n\nfunction get() {\n  router.get('/seo/:id', function (req, res) {\n    crudInst.getItem({\n      collection: conf.db.collections.seo,\n      query: { _id: req.params.id }\n    })\n    .then(function(dbRes){\n      res.json(dbRes);\n      return dbRes\n    })    \n    .catch(function(err) {\n      console.log('Ocurrió un error al tratar de conseguir la configuracion seo de tiendas:');\n      console.log(err);\n      res.json(err);\n    });\n  });\n}\n\nfunction save() {\n  router.post('/seo/:id', function(req, res) {\n    let rightNow = new Date();\n    let missingData = { modified: rightNow };\n    \n    if(!req.body.date) {\n      missingData.date = rightNow;\n    }\n\n    crudInst.update({\n      collection: conf.db.collections.seo,\n      query: { _id: req.params.id },\n      update: Object.assign(missingData, req.body),\n      options: { upsert: true }\n    })\n    .then(function(dbRes) {\n      res.json(dbRes);\n      return dbRes;\n    })\n    .catch(function(err) {\n      console.log('Ocurrió un error al tratar de Guardar la configuracion seo de tiendas:');\n      console.log(err);\n      res.json(err);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/seo.js","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\nvar csm = require('../utils/sitemaps/create-sitemap.js');\nvar crudInst;\nvar conf;\n\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .then(function(){\n    if(crudInst) {\n      _id();\n      index();\n      createStore();\n    }\n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  });\n\n  return router;\n};\n\nfunction _id() {\n  router.get('/stores/:_id', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.main,\n        query: { 'stores._id': req.params._id },\n        items_per_page: conf.db.itemsPerPage,\n        skip: conf.db.itemsPerPage*page,\n        sort: { published: -1},\n        projection: {\n          name: 1,\n          thumbnail: 1,\n          stores: 1,\n          slug: 1,\n          img: 1,\n          img_data: 1,\n          img_alt:1,\n          img_title:1,\n          categories: 1,\n          published: 1,\n          modified: 1\n        }\n      }),\n      crudInst.getItem({\n        collection:  conf.db.collections.secundary,\n        query: {_id: req.params._id},\n        projection: {name:1, thumbnail: 1, slug: 1, content: 1, url_site: 1, img: 1, img_alt:1, img_title: 1, img_data: 1}\n      }),\n      crudInst.getPagination({\n        query: { 'stores._id': req.params._id },\n        collection: conf.db.collections.main\n      }),\n      crudInst.getItem({\n        collection: conf.db.collections.seo,\n        query: {_id: 'stores'},\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          info: results[1],\n          pagination: results[2],\n          seo: results[3]\n        });\n    })\n    .catch(function(error) {\n      res.json(error);\n    });\n  });\n}\n\nfunction index() {\n  router.get('/stores', function(req, res) {\n    var page = req.query.page ? Number(req.query.page) : 0;\n    var iterable = [\n      crudInst.getItems({\n        collection: conf.db.collections.secundary,\n        items_per_page: conf.db.itemsPerPage, \n        skip: conf.db.itemsPerPage*page,\n        sort: { name: 1},\n        projection: {\n          name: 1,\n          slug: 1,\n          thumbnail: 1,\n          img: 1,\n          img_data: 1,\n          img_alt:1,\n          img_title:1,\n          published: 1,\n          modified: 1\n        }\n      }),\n      crudInst.getPagination({\n        collection: conf.db.collections.secundary\n      })\n    ];\n\n    Promise.all(iterable)\n    .then(function(results) {\n      res.json({\n          items: results[0],\n          pagination: results[1]\n        });\n    })\n    .catch(function(error) {\n      console.log(error);\n      res.json(error);\n    });\n  });\n}\n\nfunction createStore () {\n  router.post('/stores/new', function(req, res) {\n    var rightNow = new Date();\n    var data = Object.assign({ modified: rightNow, published: rightNow, _id: req.body.slug }, req.body);\n    crudInst.setItem({\n      collection: conf.db.collections.secundary,\n      document: data\n    })\n    .then(function(dbResponse){\n      res.json(dbResponse);\n      return dbResponse;\n    })\n    .catch(function(err){\n      console.log('Ocurrió un error al tratar de Guardar una Tienda:');\n      console.log(err);\n      res.json(err);\n    })\n    .then(function(dbResponse){\n      if (dbResponse.result && dbResponse.result.ok ) {\n        return crudInst.updateOne({\n          collection: conf.db.collections.pages,\n          query: { slug: '/tiendas' },\n          update: { $set: { modified: rightNow } }\n        });\n      }\n    })\n    .catch(function(err) {\n      console.log('Ocurrió un error al tratar de actualizar las paginas despues de guardar una promoción:')\n      console.log(err);\n    })\n    .then(function(dbResponse) {\n      if (dbResponse.result && dbResponse.result.ok ) {\n        return true\n      } else {\n        return Error(dbResponse);\n      }\n    })\n    .then(function(result) {\n      if(result===true) {\n        Promise.all([csm.stores(), csm.pages()])\n        .then(function(results) {\n          if (results && results.length > 0) {\n            return csm.index();\n          }\n        })\n        .catch(function(err){\n          console.log(err);\n          return err;\n        })\n      } else {\n        console.log(result);\n      }\n    })\n    .catch(function(err){\n      console.log(err);\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/stores.js","'use strict';\n\nvar express = require('express');\nvar router = express.Router();\nvar CRUD = require('../db/crud.js');\nvar mkdirp = require('mkdirp');\nvar path = require('path');\nimport multer from 'multer'\nvar jimp = require('jimp')\n\nvar crudInst;\nvar conf;\nvar rootPathUploads = '/home/jaime/static'\nmodule.exports = function(wagner, params) {\n  wagner.invoke(function(conn, config) {\n    conf = config;\n    return conn;\n  })\n  .then(function(db){\n    crudInst = new CRUD({\n      db:db\n    });\n  })\n  .then(function(){\n    if(crudInst) {\n      upload();\n    }    \n  })\n  .catch(function(err) {\n    //some configuration to notify no database connection working\n    console.log(err);\n  });\n\n  return router;\n};\n\nfunction getPath(file) {\n  var date = new Date();\n  var finalPath = path.join(`${rootPathUploads}/uploads/${date.getFullYear()}/${(date.getMonth()+1)}/${date.getDate()}`);\n  if(file) {\n    finalPath = `${finalPath}/{file.originalname}`;\n  }\n  return finalPath;\n}\n\nfunction upload() {\n  router.post('/upload', function(req, res) {\n    return multerUpload(req, res, function (err) {\n      if (err) {\n        res.json(error);\n      }\n\n      if(req.files && req.files[0]) {\n        var path = getPath();\n        var file = req.files[0];\n        var originalName = file.originalname\n        var name = originalName.split('.')[0];\n        var extension = originalName.split('.')[1];\n        var filePath = `${path}/${originalName}`;\n        var finalRootPath = path.split(rootPathUploads)[1];\n\n        jimp.read(filePath)\n        .then(function (img) {\n            return img.scaleToFit(300, 300)// resize\n                 .quality(50)// set JPEG quality\n                 .write(`${path}/${name}_thumb.${extension}`); // save\n        }).then(function(result) {\n          res.json({ success: true, img: conf.host + filePath.split(rootPathUploads)[1], thumbnail: `${conf.host}${finalRootPath}/${name}_thumb.${extension}`});\n        }).catch(function (err) {\n          res.json(err);\n        });\n      } else {\n        res.json({ success: false, msg: 'No obtuvimos ningun archivo de la peticón'});\n      }    \n    });\n  });\n}\n\nvar storage = multer.diskStorage({\n    destination: function (req, file, callback) {\n        var pathFile = getPath();\n        mkdirPromise(pathFile)\n        .then(function(success){\n          callback(null, pathFile);\n        })\n        .catch(function(err){\n          console.log(err);\n        })\n        \n    },\n    filename: function (req, file, callback) {\n        callback(null, file.originalname);\n    }\n});\n\nvar multerUpload = multer({ storage: storage }).array(\"offerFile\", 3); //Field name and max count\n\nfunction mkdirPromise (pathFile) {\n  return new Promise(function(resolve, reject){\n    mkdirp(pathFile, function (err) {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(`Directorio creado: ${pathFile}`);\n      }\n    });\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/upload.js","var xml = require('xml');\nvar utils = require('../index');\n\nconst GENERATOR = 'Feed for Node.js'\nconst DOCTYPE = '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n'\n\nclass Feed {\n\n  constructor(options) {\n    this.options = options\n    this.items = []\n    this.categories = []\n    this.contributors = []\n  }\n\n  addItem(item) {\n    this.items.push(item)\n  }\n\n  addCategory(category) {\n    this.categories.push(category)\n  }\n\n  addContributor(contributor) {\n    this.contributors.push(contributor)\n  }\n\n  render(format) {\n    console.warn('DEPRECATED: use atom1() or rss2() instead of render()');\n    if (format === 'atom-1.0') {\n      return this.atom1();\n    } else {\n      return this.rss2();\n    }\n  }\n\n  atom1() {\n    const { options } = this\n\n    let feed = [\n      { _attr: { xmlns: 'http://www.w3.org/2005/Atom' } },\n      { id: options.id },\n      { title: options.title },\n      { updated: (options.updated ? utils.getDate(options.updated) : utils.getDate(new Date())) },\n      { generator: options.generator || GENERATOR },\n    ]\n\n    let root = [{ feed }]\n\n    if (options.author) {\n      const { name, email, link } = options.author\n      let author = []\n\n      if (name) {\n        author.push({ name });\n      }\n\n      if (email) {\n        author.push({ email });\n      }\n\n      if (link) {\n        author.push({ uri: link });\n      }\n\n      feed.push({ author })\n    }\n\n    // link (rel=\"alternate\")\n    if(options.link) {\n      feed.push({ link: { _attr: { rel: 'alternate', href: options.link }}});\n    }\n\n    // link (rel=\"self\")\n    const atomLink = options.feed || (options.feedLinks && options.feedLinks.atom);\n    if(atomLink) {\n      feed.push({ \"link\": { _attr: { rel: 'self', href: atomLink }}});\n    }\n\n    // link (rel=\"hub\")\n    if(options.hub) {\n      feed.push({ link: { _attr: { rel:'hub', href: options.hub }}});\n    }\n\n    /**************************************************************************\n     * \"feed\" node: optional elements\n     *************************************************************************/\n\n    if(options.description) {\n      feed.push({ subtitle: options.description });\n    }\n\n    if(options.image) {\n      feed.push({ logo: options.image });\n    }\n\n    if(options.favicon) {\n      feed.push({ icon: options.favicon });\n    }\n\n    if(options.copyright) {\n      feed.push({ rights: options.copyright });\n    }\n\n    this.categories.forEach(category => {\n      feed.push({ category: [{ _attr: { term: category } }] });\n    })\n\n    this.contributors.forEach(item => {\n      const { name, email, link } = item\n      let contributor = [];\n\n      if(name) {\n        contributor.push({ name });\n      }\n\n      if(email) {\n        contributor.push({ email });\n      }\n\n      if(link) {\n        contributor.push({ uri: link });\n      }\n\n      feed.push({ contributor });\n    })\n\n    // icon\n\n    /**************************************************************************\n     * \"entry\" nodes\n     *************************************************************************/\n    this.items.forEach(item => {\n      //\n      // entry: required elements\n      //\n\n      let entry = [\n        { title: { _attr: { type: 'html' }, _cdata: item.title }},\n        { id: item.id || item.link },\n        { link: [{ _attr: { href: item.link } }]},\n        { updated: utils.getDate(item.date) }\n      ]\n\n      //\n      // entry: recommended elements\n      //\n      if(item.description) {\n        entry.push({ summary: { _attr: { type: 'html' }, _cdata: item.description }});\n      }\n\n      if(item.content) {\n        entry.push({ content: { _attr: { type: 'html' }, _cdata: item.content }});\n      }\n\n      // entry author(s)\n      if(Array.isArray(item.author)) {\n        item.author.forEach(oneAuthor => {\n          const { name, email, link } = oneAuthor\n          let author = [];\n\n          if(name) {\n            author.push({ name });\n          }\n\n          if(email) {\n            author.push({ email });\n          }\n\n          if(link) {\n            author.push({ uri: link });\n          }\n\n          entry.push({ author });\n        })\n      }\n\n      // content\n\n      // link - relative link to article\n\n      //\n      // entry: optional elements\n      //\n\n      // category\n\n      // contributor\n      if(Array.isArray(item.contributor)) {\n        item.contributor.forEach(item => {\n          const { name, email, link } = item\n          let contributor = [];\n\n          if(name) {\n            contributor.push({ name });\n          }\n\n          if(email) {\n            contributor.push({ email });\n          }\n\n          if(link) {\n            contributor.push({ uri: link });\n          }\n\n          entry.push({ contributor });\n        })\n      }\n\n      // published\n      if(item.published) {\n        entry.push({ published: utils.getDate(item.published) });\n      }\n\n      // source\n\n      // rights\n      if(item.copyright) {\n        entry.push({ rights: item.copyright });\n      }\n\n      feed.push({ entry: entry });\n    })\n\n    return DOCTYPE + xml(root, true);\n  }\n\n  rss2() {\n    const { options } = this\n    let isAtom = false\n    let isContent = false\n\n    let channel = [\n      { title: options.title },\n      { link: options.link },\n      { description: options.description },\n      { lastBuildDate: (options.updated ? utils.getDate(options.updated) : utils.getDate(new Date())) },\n      { docs: 'http://blogs.law.harvard.edu/tech/rss'},\n      { generator: options.generator || GENERATOR },\n    ]\n\n    let rss = [\n      { _attr: { version: '2.0' } },\n      { channel },\n    ]\n\n    let root = [{ rss }]\n\n    /**\n     * Channel Image\n     * http://cyber.law.harvard.edu/rss/rss.html#ltimagegtSubelementOfLtchannelgt\n     */\n    if(options.image) {\n       channel.push({\n        image: [\n          { title: options.title },\n          { url: options.image },\n          { link: options.link },\n        ]\n      });\n     }\n\n    /**\n     * Channel Copyright\n     * http://cyber.law.harvard.edu/rss/rss.html#optionalChannelElements\n     */\n    if(options.copyright) {\n      channel.push({ copyright: options.copyright });\n    }\n\n    /**\n     * Channel Categories\n     * http://cyber.law.harvard.edu/rss/rss.html#comments\n     */\n    this.categories.forEach(category => {\n      channel.push({ category });\n    })\n\n    /**\n     * Feed URL\n     * http://validator.w3.org/feed/docs/warning/MissingAtomSelfLink.html\n     */\n    const atomLink = options.feed || (options.feedLinks && options.feedLinks.atom);\n    if(atomLink) {\n      isAtom = true\n\n      channel.push({\n        \"atom:link\": {\n          _attr: {\n            href: atomLink,\n            rel: 'self',\n            type: 'application/rss+xml',\n          },\n        },\n      })\n    }\n\n    /**\n     * Hub for PubSubHubbub\n     * https://code.google.com/p/pubsubhubbub/\n     */\n    if(options.hub) {\n      isAtom = true;\n      channel.push({\n        \"atom:link\": {\n          _attr: {\n            href: options.hub,\n            rel: 'hub',\n          },\n        },\n      })\n    }\n\n    /**\n     * Channel Categories\n     * http://cyber.law.harvard.edu/rss/rss.html#hrelementsOfLtitemgt\n     */\n    this.items.forEach(entry => {\n      let item = [];\n\n      if(entry.title) {\n        item.push({ title: { _cdata: entry.title }});\n      }\n\n      if(entry.link) {\n        item.push({ link: entry.link });\n      }\n\n      if(entry.guid) {\n        item.push({ guid: entry.guid });\n      } else if (entry.link) {\n        item.push({ guid: entry.link });\n      }\n\n      if(entry.date) {\n        item.push({ pubDate: utils.getDate(entry.date, 'GMT') });\n      }\n\n      if(entry.description) {\n        item.push({ description: { _cdata: entry.description }});\n      }\n\n      if(entry.content) {\n        isContent = true;\n        item.push({ 'content:encoded': { _cdata: entry.content }});\n      }\n      /**\n       * Item Author\n       * http://cyber.law.harvard.edu/rss/rss.html#ltauthorgtSubelementOfLtitemgt\n       */\n      if(Array.isArray(entry.author)) {\n        entry.author.some(author => {\n          if (author.email && author.name) {\n            item.push({ author: author.email + ' (' + author.name + ')' })\n            return true\n          } else {\n            return false\n          }\n        })\n      }\n\n      if(item.image) {\n        item.push({ enclosure: [{ _attr: { url: entry.image } }] });\n      }\n\n      channel.push({ item });\n    })\n\n    if(isContent) {\n      rss[0]._attr['xmlns:content'] = 'http://purl.org/rss/1.0/modules/content/';\n    }\n\n    if(isAtom) {\n      rss[0]._attr['xmlns:atom'] = 'http://www.w3.org/2005/Atom';\n    }\n\n    return DOCTYPE + xml(root, true);\n  }\n\n  json1() {\n    const { options, items } = this\n    let feed = {\n      version: 'https://jsonfeed.org/version/1',\n      title: options.title,\n    };\n\n    if (options.link) {\n      feed.home_page_url = options.link;\n    }\n\n    if (options.feedLinks && options.feedLinks.json) {\n      feed.feed_url = options.feedLinks.json;\n    }\n\n    if (options.description) {\n      feed.description = options.description;\n    }\n\n\n    if (options.image) {\n      feed.icon = options.image;\n    }\n\n    if (options.author) {\n      feed.author = {};\n      if (options.author.name) {\n          feed.author.name = options.author.name;\n      }\n      if (options.author.link) {\n          feed.author.url = options.author.link;\n      }\n    }\n    feed.items = items.map(item => {\n      let feedItem = {\n        id: item.id,\n        // json_feed distinguishes between html and text content\n        // but since we only take a single type, we'll assume HTML\n        html_content: item.content,\n      }\n      if (item.link) {\n        feedItem.url = item.link;\n      }\n      if(item.title) {\n        feedItem.title = item.title;\n      }\n      if (item.description) {\n        feedItem.summary = item.description;\n      }\n\n      if (item.image) {\n        feedItem.image = item.image\n      }\n\n      if (item.date) {\n        feedItem.date_modified = utils.getDate(item.date);\n      }\n      if (item.published) {\n        feedItem.date_published = utils.getDate(item.published);\n      }\n\n      if (item.author) {\n        let author = item.author;\n        if (author instanceof Array) {\n          // json feed only supports 1 author per post\n          author = author[0];\n        }\n        feedItem.author = {};\n        if (author.name) {\n            feedItem.author.name = author.name;\n        }\n        if (author.link) {\n            feedItem.author.url = author.link;\n        }\n      }\n      return feedItem;\n    });\n\n    return JSON.stringify(feed, null, 4);\n  }\n\n  ISODateString(d) {\n    function pad(n) {\n      return n<10 ? '0'+n : n\n    }\n\n    return d.getUTCFullYear() + '-'\n      + pad(d.getUTCMonth() + 1) + '-'\n      + pad(d.getUTCDate()) + 'T'\n      + pad(d.getUTCHours()) + ':'\n      + pad(d.getUTCMinutes()) + ':'\n      + pad(d.getUTCSeconds()) + 'Z'\n  }\n\n}\n\nmodule.exports = Feed\n\n\n\n// WEBPACK FOOTER //\n// ./server/utils/feed/feed.js","var config = require('../../config.js').config;\nvar Feed = require('./feed');\nvar fs = require('fs');\nvar striptags = require('striptags');\nvar utils = require('../index.js');\nvar cron = require('node-cron');\n\nvar rootFeed = config.paths.feed\n\nmodule.exports = {\n\n\tcreate () {\n\t\tutils.getCrud()\n\t\t.then(function(crud){\n\t\t\treturn crud.getItems({\n\t\t\t\tcollection: config.db.collections.main,\n\t\t\t\titems_per_page: 10,\n\t\t\t\tsort: { published: -1}\n\t\t\t});\n\t\t})\n\t\t.then(function(docs){\n\t\t\tvar feedXml = new Feed({\n\t\t\t\ttitle: 'Ofertadeo',\n\t\t\t\tdescription: 'Nuevas ofertas',\n\t\t\t\tlink: config.host,\n\t\t\t\timage: config.host + '/logo.png',\n\t\t\t  favicon: config.host + '/favicons/favicon.ico',\n\t\t\t  copyright: 'Ofertadeo',\n\t\t\t  updated: new Date(),\n\t\t\t  generator: 'ofertadeo',\n\t\t\t  feedLinks: {\n\t\t\t    json: config.host + '/feed/feed-json.json',\n\t\t\t    atom: config.host + '/feed/feed-atom.xml',\n\t\t\t  }\n\t\t\t});\n\n\t\t\tdocs.forEach(function(doc) {\n\t\t\t\tlet content = striptags(doc.content);\n\t\t    let description = content.slice(0, 150);\n\t\t    if (description.length === 150) {\n\t\t    \tdescription += '...';\n\t\t    }\n\t\t\t\tfeedXml.addItem({\n\t\t\t    title: doc.title,\n\t\t\t    link: config.host + config.routes.main + '/' + doc.slug,\n\t\t\t    description: description,\n\t\t\t    content: doc.content,\n\t\t\t    category: doc.categories[0],\n\t\t\t    date: doc.published,\n\t\t\t    image: doc.img\n\t\t\t  });\n\t\t\t});\n\n\t\t\tfs.writeFile(rootFeed + '/feed-rss2.xml', feedXml.rss2(), 'utf8', function(err) {\n\t\t    if (err) {\n\t\t      return console.log(err);\n\t\t    }\n\t\t    console.log('RSS2 was created :=)');\n\t\t  });\n\n\t\t  fs.writeFile(rootFeed + '/feed-atom.xml', feedXml.atom1(), 'utf8', function(err) {\n\t\t    if (err) {\n\t\t      return console.log(err);\n\t\t    }\n\t\t    console.log('Atom was created :=)');\n\t\t  });\n\n\t\t  fs.writeFile(rootFeed + '/feed-json.json', feedXml.atom1(), 'utf8', function(err) {\n\t\t    if (err) {\n\t\t      return console.log(err);\n\t\t    }\n\t\t    console.log('JSON was created :=)');\n\t\t  });\n\n\t\t})\n\t\t.then(function(){\n\t\t\tconsole.log('OK')\n\t\t})\n\t\t.catch(function(err){\n\t\t\tconsole.log(err);\n\t\t});\n\t},\n\n\tschedule () {\n\t\tvar index = this;\n\t\t//cron.schedule('*/1 * * * *', function (){\n\t\tcron.schedule('1 12 * * *', function (){ //run every day at 12:00 hrs\n\t\t  utils\n\t\t  .checkIfNewOffers()\n\t\t  .then(function(res) {\n\t\t  \tconsole.log('feedburne');\n\t\t  \tif(res && res.news) {\n\t\t  \t\tindex.create();\n\t\t  \t}\n\t\t  \tconsole.log(res);\n\t\t  }).catch(function(err) {\n\t\t  \tconsole.log(err);\n\t\t  });\n\t\t});\n\n\t\t//cron.schedule('*/1 * * * *', function (){\n\t\tcron.schedule('50 23 * * *', function () {//run every day at 23:50 hours\n\t\t\t\tutils\n\t\t  \t.checkIfNewOffers()\n\t\t\t\t.then(function(res) {\n\t\t\t\t\tconsole.log('feedburne');\n\t\t\t  \tif(res && res.news) {\n\t\t\t  \t\tindex.create();\n\t\t\t  \t}\n\t\t\t  \tconsole.log(res);\n\t\t\t  }).catch(function(err) {\n\t\t\t  \tconsole.log(err);\n\t\t\t  });\n\t\t});\t\n\t}\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/feed/index.js","var request = require('request');\nvar apiKey = '61e4d89d5d5d1391dc97ca0c471003d4';\nif (process.env.NODE_ENV === 'production') {\n\tapiKey = 'e5dd4f8caaa635b423152ea1ad66ded8';\n}\n\nmodule.exports = {\n\tall (data) {\n\t\trequest({\n\t\t\turl: 'https://pushcrew.com/api/v1/send/all',\n\t\t\theaders: {\n\t\t\t\t'Authorization': 'key=' + apiKey\n\t\t\t},\n\t\t\tmethod: 'POST'\n\t\t})\n\t\t.form(data)\n\t\t.on('response', function(response) {\n\t\t\tconsole.log('Respuesta de https://pushcrew.com/api/v1/send/all')\n\t\t\tconsole.log(response.status);\n\t\t\tconsole.log(response.request_id);\n\t\t\tconsole.log(response.statusCode);\n\t\t\tconsole.log(response.statusMessage);\n\t\t})\n\t\t.on('error', function(err) {\n\t\t\tconsole.log('Error de https://pushcrew.com/api/v1/send/all')\n\t\t\tconsole.log(err);\n\t\t});\n\t}\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/pn/index.js","var wagner = require('wagner-core');\r\nvar sm = require('sitemap')\r\nvar config = require('../../config.js')(wagner);\r\nvar fs = require('fs');\r\nvar zlib = require('zlib');\r\nvar utils = require('../index.js')\r\n\r\nfunction compress(path) {\r\n  var readable = fs.createReadStream(path);\r\n  var writable = fs.createWriteStream(path + '.gz');\r\n  var gzip = zlib.createGzip();\r\n  \r\n  return readable.pipe(gzip).pipe(writable);\r\n}\r\n\r\nfunction createSitemap () {\r\n  var sitemap = sm.createSitemap({\r\n    hostname: config.host,\r\n    xmlNs: `xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\r\n      xmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\"\r\n      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n      xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\r\n      xsi:schemaLocation=\"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd\"`\r\n  });\r\n\r\n  return sitemap\r\n}\r\n\r\nfunction addToSitemap(sitemap, data, params) {\r\n  data.forEach(function(current) {\r\n    var obj = {\r\n      url: params.route + '/' + current.slug,\r\n      changefreq: params.changefreq || 'daily',\r\n      priority: params.priority || 0.5,\r\n      lastmodISO: utils.getDate(current.modified)\r\n    };\r\n\r\n    if (current.img) {\r\n      obj.img = {\r\n        url: current.img,\r\n        caption: current.img_alt,\r\n        title: current.img_title,\r\n      };\r\n    }\r\n             \r\n    sitemap.add(obj);\r\n  });\r\n\r\n  return sitemap\r\n}\r\n\r\nfunction createSitemapFile (sitemap, params) {\r\n  return new Promise(function(resolve, reject) {\r\n    fs.writeFile(params.sitemap_path, sitemap.toString(), function(err) {\r\n      if (err) {\r\n        console.log(err);\r\n        reject(err);\r\n      }\r\n\r\n      var readable = fs.createReadStream(params.sitemap_path);\r\n      var writable = fs.createWriteStream(params.sitemap_path + '.gz');\r\n      var gzip = zlib.createGzip();\r\n      \r\n      readable.pipe(gzip).pipe(writable);\r\n\r\n      gzip\r\n      .on('error', function(err){\r\n        console.log(err);\r\n        reject(err);\r\n      })\r\n      .on('end', function () {\r\n        writable.end();\r\n        console.log(params.sitemap_path + ' sitemap file is compressed!!')\r\n        resolve(params.sitemap_path + ' sitemap file is compressed!!');\r\n      });\r\n      \r\n    });\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  createSitemap: createSitemap,\r\n  createSitemapFile: createSitemapFile,\r\n  compress: compress,\r\n  addToSitemap: addToSitemap,\r\n};\n\n\n// WEBPACK FOOTER //\n// ./server/utils/sitemaps/utils.js","module.exports = require(\"jimp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jimp\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"striptags\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"striptags\"\n// module id = 35\n// module chunks = 0","module.exports = require(\"xml\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"xml\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"zlib\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"zlib\"\n// module id = 37\n// module chunks = 0","import Nuxt from 'nuxt'\nimport express from 'express'\nimport compression from 'compression'\nimport helmet from 'helmet'\nimport api from './api'\nimport bodyParser from 'body-parser' \nimport morgan from 'morgan'\nimport rfs from 'rotating-file-stream'\nimport path from 'path'\nimport fs from 'fs'\nimport sitemapSchedule from './utils/sitemaps/schedule'\n\nconst develop = !(process.env.NODE_ENV === 'production')\nconst app = express()\nconst host = process.env.HOST || '127.0.0.1'\nconst port = process.env.PORT || 3000\nlet morganFormat = 'combined'\n\nlet logDirectory = path.join(__dirname, '../log')\n// ensure log directory exists\nfs.existsSync(logDirectory) || fs.mkdirSync(logDirectory)\n// create a rotating write stream\nvar accessLogStream = rfs('access.log', {\n  interval: '1d', // rotate daily\n  path: logDirectory\n})\n\napp.set('port', port)\n\n//For some reason in develop, express precondition provoke an error when the user load more\n//offers using ajax\nif(!develop) {\n\t//const preconditions = require('express-preconditions');\n\t//app.use(preconditions())\n  //morganFormat = 'dev'\n}\napp.use(bodyParser.json({ limit: '3mb'}))\n// Import API Routes\napp.use('/api', api)\napp.use(morgan(morganFormat, { stream: accessLogStream }))\n//Security\napp.use(helmet())\napp.disable('x-powered-by');\n\n// Import and Set Nuxt.js options\nlet nuxtConfig = require('../nuxt.config.js')\nnuxtConfig.dev = develop\n\n// Init Nuxt.js\nconst nuxt = new Nuxt(nuxtConfig)\n//before nuxt render to compress data\napp.set('view cache', true);//Cache template compilation\napp.use(compression());//Compress all the data that the server response\n\n//At the end because it won't call next()\napp.use(nuxt.render)\n\n// Build only in dev mode\nif (nuxtConfig.dev) {\n  nuxt.build()\n  .catch((error) => {\n    console.error(error) // eslint-disable-line no-console\n    process.exit(1)\n  })\n}\n\n// Listen the server\napp.listen(port)\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n//Schedule ping to web search engines\nsitemapSchedule.ping()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}